"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{9794:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(9432),o=n(2358),s=n(1379),l=n(3051),r=n(8882);function a(e,t,n,a,d,c){const f=e.element.originElement.ownerDocument||document,h=f.defaultView||window,u=l.Z,g=d.icons,m={_d:f,_w:h,_parser:new h.DOMParser,_prevRtl:d.rtl,_wd:null,_ww:null,_shadowRoot:null,_shadowRootControllerEventTarget:null,util:u,functions:null,options:null,wwComputedStyle:null,notice:r.Z,icons:g,history:null,context:e,pluginCallButtons:t,plugins:n||{},initPlugins:{},_targetPlugins:{},_menuTray:{},lang:a,effectNode:null,submenu:null,container:null,_submenuName:"",_bindedSubmenuOff:null,_bindedContainerOff:null,submenuActiveButton:null,containerActiveButton:null,controllerArray:[],currentControllerName:"",currentControllerTarget:null,currentFileComponentInfo:null,codeViewDisabledButtons:[],resizingDisabledButtons:[],_moreLayerActiveButton:null,_htmlCheckWhitelistRegExp:null,_htmlCheckBlacklistRegExp:null,_disallowedTextTagsRegExp:null,editorTagsWhitelistRegExp:null,editorTagsBlacklistRegExp:null,pasteTagsWhitelistRegExp:null,pasteTagsBlacklistRegExp:null,hasFocus:!1,isDisabled:!1,isReadOnly:!1,_attributesWhitelistRegExp:null,_attributesBlacklistRegExp:null,_attributesTagsWhitelist:null,_attributesTagsBlacklist:null,_bindControllersOff:null,_isInline:null,_isBalloon:null,_isBalloonAlways:null,_inlineToolbarAttr:{top:"",width:"",isShow:!1},_notHideToolbar:!1,_sticky:!1,_antiBlur:!1,_lineBreaker:null,_lineBreakerButton:null,_componentsInfoInit:!0,_componentsInfoReset:!1,activePlugins:null,managedTagsInfo:null,_charTypeHTML:!1,_fileInfoPluginsCheck:null,_fileInfoPluginsReset:null,_fileManager:{tags:null,regExp:null,queryString:null,pluginRegExp:null,pluginMap:null},commandMap:null,_commandMapStyles:{STRONG:["font-weight"],U:["text-decoration"],EM:["font-style"],DEL:["text-decoration"]},allCommandButtons:null,_styleCommandMap:null,_defaultCommand:{bold:d.textTags.bold,underline:d.textTags.underline,italic:d.textTags.italic,strike:d.textTags.strike,subscript:d.textTags.sub,superscript:d.textTags.sup},_variable:{isChanged:!1,isCodeView:!1,isFullScreen:!1,innerHeight_fullScreen:0,resizeClientY:0,tabSize:4,codeIndent:2,minResizingSize:u.getNumber(e.element.wysiwygFrame.style.minHeight||"65",0),currentNodes:[],currentNodesMap:[],_range:null,_selectionNode:null,_originCssText:e.element.topArea.style.cssText,_bodyOverflow:"",_editorAreaOriginCssText:"",_wysiwygOriginCssText:"",_codeOriginCssText:"",_fullScreenAttrs:{sticky:!1,balloon:!1,inline:!1},_lineBreakComp:null,_lineBreakDir:""},saveButtonStates:function(){this.allCommandButtons||(this.allCommandButtons={});const e=this.context.element._buttonTray.querySelectorAll(".se-menu-list button[data-display]");for(let t,n,i=0;i<e.length;i++)t=e[i],n=t.getAttribute("data-command"),this.allCommandButtons[n]=t},recoverButtonStates:function(){if(this.allCommandButtons){const e=this.context.element._buttonTray.querySelectorAll(".se-menu-list button[data-display]");for(let t,n,i,o=0;o<e.length;o++)t=e[o],n=t.getAttribute("data-command"),i=this.allCommandButtons[n],i&&(t.parentElement.replaceChild(i,t),this.context.tool[n]&&(this.context.tool[n]=i))}},callPlugin:function(e,n,i){if(i=i||t[e],!this.plugins[e])throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:"'+e+'")');this.initPlugins[e]?"object"===typeof this._targetPlugins[e]&&i&&this.initMenuTarget(e,i,this._targetPlugins[e]):(this.plugins[e].add(this,i),this.initPlugins[e]=!0),this.plugins[e].active&&!this.commandMap[e]&&i&&(this.commandMap[e]=i,this.activePlugins.push(e)),"function"===typeof n&&n()},addModule:function(e){for(let t,n=0,i=e.length;n<i;n++)t=e[n].name,this.plugins[t]||(this.plugins[t]=e[n]),this.initPlugins[t]||(this.initPlugins[t]=!0,"function"===typeof this.plugins[t].add&&this.plugins[t].add(this))},getGlobalScrollOffset:function(){let t=0,n=0,i=e.element.topArea;for(;i;)t+=i.scrollTop,n+=i.scrollLeft,i=i.parentElement;for(i=this._shadowRoot?this._shadowRoot.host:null;i;)t+=i.scrollTop,n+=i.scrollLeft,i=i.parentElement;return{top:t,left:n}},initMenuTarget:function(t,n,i){n?(e.element._menuTray.appendChild(i),this._targetPlugins[t]=!0,this._menuTray[n.getAttribute("data-command")]=i):this._targetPlugins[t]=i},submenuOn:function(e){this._bindedSubmenuOff&&this._bindedSubmenuOff(),this._bindControllersOff&&this.controllersOff();const t=this._submenuName=e.getAttribute("data-command"),n=this.submenu=this._menuTray[t];this.submenuActiveButton=e,this._setMenuPosition(e,n),this._bindedSubmenuOff=this.submenuOff.bind(this),this.addDocEvent("mousedown",this._bindedSubmenuOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this),this._antiBlur=!0},submenuOff:function(){this.removeDocEvent("mousedown",this._bindedSubmenuOff),this._bindedSubmenuOff=null,this.submenu&&(this._submenuName="",this.submenu.style.display="none",this.submenu=null,u.removeClass(this.submenuActiveButton,"on"),this.submenuActiveButton=null,this._notHideToolbar=!1),this._antiBlur=!1},moreLayerOff:function(){if(this._moreLayerActiveButton){e.element.toolbar.querySelector("."+this._moreLayerActiveButton.getAttribute("data-command")).style.display="none",u.removeClass(this._moreLayerActiveButton,"on"),this._moreLayerActiveButton=null}},containerOn:function(e){this._bindedContainerOff&&this._bindedContainerOff();const t=this._containerName=e.getAttribute("data-command"),n=this.container=this._menuTray[t];this.containerActiveButton=e,this._setMenuPosition(e,n),this._bindedContainerOff=this.containerOff.bind(this),this.addDocEvent("mousedown",this._bindedContainerOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this),this._antiBlur=!0},containerOff:function(){this.removeDocEvent("mousedown",this._bindedContainerOff),this._bindedContainerOff=null,this.container&&(this._containerName="",this.container.style.display="none",this.container=null,u.removeClass(this.containerActiveButton,"on"),this.containerActiveButton=null,this._notHideToolbar=!1),this._antiBlur=!1},_setMenuPosition:function(t,n){n.style.visibility="hidden",n.style.display="block",n.style.height="",u.addClass(t,"on");const i=this.context.element.toolbar,o=i.offsetWidth,s=p._getEditorOffsets(e.element.toolbar),l=n.offsetWidth,r=t.parentElement.offsetLeft+3;if(d.rtl){const e=t.offsetWidth,i=l>e?l-e:0,o=i>0?0:e-l;n.style.left=r-i+o+"px",s.left>p._getEditorOffsets(n).left&&(n.style.left="0px")}else{const e=o<=l?0:o-(r+l);n.style.left=e<0?r+e+"px":r+"px"}let a=0,c=t;for(;c&&c!==i;)a+=c.offsetTop,c=c.offsetParent;const f=a;this._isBalloon?a+=i.offsetTop+t.offsetHeight:a-=t.offsetHeight;const g=s.top,m=n.offsetHeight,y=this.getGlobalScrollOffset().top,C=h.innerHeight-(g-y+f+t.parentElement.offsetHeight);if(C<m){let e=-1*(m-f+3);const i=g-y+e,o=m+(i<0?i:0);o>C?(n.style.height=o+"px",e=-1*(o-f+3)):(n.style.height=C+"px",e=f+t.parentElement.offsetHeight),n.style.top=e+"px"}else n.style.top=f+t.parentElement.offsetHeight+"px";n.style.visibility=""},controllersOn:function(){this._bindControllersOff&&this._bindControllersOff(),this.controllerArray=[];for(let e,t=0;t<arguments.length;t++)e=arguments[t],e&&("string"!==typeof e?"function"!==typeof e?u.hasClass(e,"se-controller")?(e.style&&(e.style.display="block",this._shadowRoot&&-1===this._shadowRootControllerEventTarget.indexOf(e)&&(e.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation()})),this._shadowRootControllerEventTarget.push(e))),this.controllerArray.push(e)):(this.currentControllerTarget=e,this.currentFileComponentInfo=this.getFileComponent(e)):this.controllerArray.push(e):this.currentControllerName=e);this._bindControllersOff=this.controllersOff.bind(this),this.addDocEvent("mousedown",this._bindControllersOff,!1),this.addDocEvent("keydown",this._bindControllersOff,!1),this._antiBlur=!0,"function"===typeof y.showController&&y.showController(this.currentControllerName,this.controllerArray,this)},controllersOff:function(t){this._lineBreaker.style.display="none";const n=this.controllerArray.length;if(t&&t.target&&n>0)for(let e=0;e<n;e++)if("function"===typeof this.controllerArray[e].contains&&this.controllerArray[e].contains(t.target))return;if((!this._fileManager.pluginRegExp.test(this.currentControllerName)||!t||"keydown"!==t.type||27===t.keyCode)&&(e.element.lineBreaker_t.style.display=e.element.lineBreaker_b.style.display="none",this._variable._lineBreakComp=null,this.currentControllerName="",this.currentControllerTarget=null,this.currentFileComponentInfo=null,this.effectNode=null,this._bindControllersOff)){if(this.removeDocEvent("mousedown",this._bindControllersOff),this.removeDocEvent("keydown",this._bindControllersOff),this._bindControllersOff=null,n>0){for(let e=0;e<n;e++)"function"===typeof this.controllerArray[e]?this.controllerArray[e]():this.controllerArray[e].style.display="none";this.controllerArray=[]}this._antiBlur=!1}},setControllerPosition:function(t,n,i,o){d.rtl&&(o.left*=-1);const s=u.getOffset(n,e.element.wysiwygFrame);t.style.visibility="hidden",t.style.display="block";const l="top"===i?-(t.offsetHeight+2):n.offsetHeight+12;t.style.top=s.top+l+o.top+"px";const r=s.left-e.element.wysiwygFrame.scrollLeft+o.left,a=t.offsetWidth,c=n.offsetWidth,f=u.hasClass(t.firstElementChild,"se-arrow")?t.firstElementChild:null;if(d.rtl){const n=a>c?a-c:0,i=n>0?0:c-a;t.style.left=r-n+i+"px",n>0&&f&&(f.style.left=(a-14<10+n?a-14:10+n)+"px");const o=e.element.wysiwygFrame.offsetLeft-t.offsetLeft;o>0&&(t.style.left="0px",f&&(f.style.left=o+"px"))}else{t.style.left=r+"px";const n=e.element.wysiwygFrame.offsetWidth-(t.offsetLeft+a);n<0?(t.style.left=t.offsetLeft+n+"px",f&&(f.style.left=20-n+"px")):f&&(f.style.left="20px")}t.style.visibility=""},execCommand:function(e,t,n){this._wd.execCommand(e,t,"formatBlock"===e?"<"+n+">":n),this.history.push(!0)},nativeFocus:function(){this.__focus(),this._editorRange()},__focus:function(){const t=u.getParentElement(this.getSelectionNode(),"figcaption");t?t.focus():e.element.wysiwyg.focus()},focus:function(){if("none"!==e.element.wysiwygFrame.style.display){if(d.iframe)this.nativeFocus();else try{const t=this.getRange();if(t.startContainer===t.endContainer&&u.isWysiwygDiv(t.startContainer)){const n=t.commonAncestorContainer.children[t.startOffset];if(!u.isFormatElement(n)&&!u.isComponent(n)){const t=u.createElement(d.defaultTag),i=u.createElement("BR");return t.appendChild(i),e.element.wysiwyg.insertBefore(t,n),void this.setRange(i,0,i,0)}}this.setRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}catch(t){this.nativeFocus()}p._applyTagEffects(),this._isBalloon&&p._toggleToolbarBalloon()}},focusEdge:function(t){t||(t=e.element.wysiwyg.lastElementChild);const n=this.getFileComponent(t);n?this.selectComponent(n.target,n.pluginName):t?(t=u.getChildElement(t,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!0))?this.setRange(t,t.textContent.length,t,t.textContent.length):this.nativeFocus():this.focus()},blur:function(){d.iframe?e.element.wysiwygFrame.blur():e.element.wysiwyg.blur()},setRange:function(e,t,n,i){if(!e||!n)return;t>e.textContent.length&&(t=e.textContent.length),i>n.textContent.length&&(i=n.textContent.length),u.isFormatElement(e)&&(e=e.childNodes[t]||e,t=0),u.isFormatElement(n)&&(n=n.childNodes[i]||n,i=t>1?t:0);const o=this._wd.createRange();try{o.setStart(e,t),o.setEnd(n,i)}catch(l){return console.warn("[SUNEDITOR.core.focus.error] "+l),void this.nativeFocus()}const s=this.getSelection();return s.removeAllRanges&&s.removeAllRanges(),s.addRange(o),this._rangeInfo(o,this.getSelection()),d.iframe&&this.__focus(),o},removeRange:function(){this._variable._range=null,this._variable._selectionNode=null,this.hasFocus&&this.getSelection().removeAllRanges(),this._setKeyEffect([])},getRange:function(){const t=this._variable._range||this._createDefaultRange(),n=this.getSelection();if(t.collapsed===n.isCollapsed||!e.element.wysiwyg.contains(n.focusNode))return t;if(n.rangeCount>0)return this._variable._range=n.getRangeAt(0),this._variable._range;{const e=n.anchorNode,t=n.focusNode,i=n.anchorOffset,o=n.focusOffset,s=u.compareElements(e,t),l=s.ancestor&&(0===s.result?i<=o:s.result>1);return this.setRange(l?e:t,l?i:o,l?t:e,l?o:i)}},getRange_addLine:function(t,n){if(this._selectionVoid(t)){const i=e.element.wysiwyg,o=u.createElement(d.defaultTag);o.innerHTML="<br>",i.insertBefore(o,n&&n!==i?n.nextElementSibling:i.firstElementChild),this.setRange(o.firstElementChild,0,o.firstElementChild,1),t=this._variable._range}return t},getSelection:function(){return this._shadowRoot&&this._shadowRoot.getSelection?this._shadowRoot.getSelection():this._ww.getSelection()},getSelectionNode:function(){if(e.element.wysiwyg.contains(this._variable._selectionNode)||this._editorRange(),!this._variable._selectionNode){const t=u.getChildElement(e.element.wysiwyg.firstChild,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!1);if(t)return this._variable._selectionNode=t,t;this._editorRange()}return this._variable._selectionNode},_editorRange:function(){const e=this.getSelection();if(!e)return null;let t=null;t=e.rangeCount>0?e.getRangeAt(0):this._createDefaultRange(),u.isFormatElement(t.endContainer)&&0===t.endOffset&&(t=this.setRange(t.startContainer,t.startOffset,t.startContainer,t.startContainer.length)),this._rangeInfo(t,e)},_rangeInfo:function(e,t){let n=null;this._variable._range=e,n=e.collapsed?u.isWysiwygDiv(e.commonAncestorContainer)&&e.commonAncestorContainer.children[e.startOffset]||e.commonAncestorContainer:t.extentNode||t.anchorNode,this._variable._selectionNode=n},_createDefaultRange:function(){const t=e.element.wysiwyg;t.focus();const n=this._wd.createRange();let i=t.firstElementChild;return i||(i=u.createElement(d.defaultTag),i.innerHTML="<br>",t.appendChild(i)),n.setStart(i,0),n.setEnd(i,0),n},_selectionVoid:function(e){const t=e.commonAncestorContainer;return u.isWysiwygDiv(e.startContainer)&&u.isWysiwygDiv(e.endContainer)||/FIGURE/i.test(t.nodeName)||this._fileManager.regExp.test(t.nodeName)||u.isMediaComponent(t)},_resetRangeToTextNode:function(){const t=this.getRange();if(this._selectionVoid(t))return!1;let n,i,o,s=t.startContainer,l=t.startOffset,r=t.endContainer,a=t.endOffset;if(u.isFormatElement(s))for(s.childNodes[l]?(s=s.childNodes[l]||s,l=0):(s=s.lastChild||s,l=s.textContent.length);s&&1===s.nodeType&&s.firstChild;)s=s.firstChild||s,l=0;if(u.isFormatElement(r)){for(r=r.childNodes[a]||r.lastChild||r;r&&1===r.nodeType&&r.lastChild;)r=r.lastChild;a=r.textContent.length}if(n=u.isWysiwygDiv(s)?e.element.wysiwyg.firstChild:s,i=l,u.isBreak(n)||1===n.nodeType&&n.childNodes.length>0){const e=u.isBreak(n);if(!e){for(;n&&!u.isBreak(n)&&1===n.nodeType;)n=n.childNodes[i]||n.nextElementSibling||n.nextSibling,i=0;let e=u.getFormatElement(n,null);e===u.getRangeFormatElement(e,null)&&(e=u.createElement(u.getParentElement(n,u.isCell)?"DIV":d.defaultTag),n.parentNode.insertBefore(e,n),e.appendChild(n))}if(u.isBreak(n)){const t=u.createTextNode(u.zeroWidthSpace);n.parentNode.insertBefore(t,n),n=t,e&&s===r&&(r=n,a=1)}}if(s=n,l=i,n=u.isWysiwygDiv(r)?e.element.wysiwyg.lastChild:r,i=a,u.isBreak(n)||1===n.nodeType&&n.childNodes.length>0){const e=u.isBreak(n);if(!e){for(;n&&!u.isBreak(n)&&1===n.nodeType&&(o=n.childNodes,0!==o.length);)n=o[i>0?i-1:i]||!/FIGURE/i.test(o[0].nodeName)?o[0]:n.previousElementSibling||n.previousSibling||s,i=i>0?n.textContent.length:i;let e=u.getFormatElement(n,null);e===u.getRangeFormatElement(e,null)&&(e=u.createElement(u.isCell(e)?"DIV":d.defaultTag),n.parentNode.insertBefore(e,n),e.appendChild(n))}if(u.isBreak(n)){const t=u.createTextNode(u.zeroWidthSpace);n.parentNode.insertBefore(t,n),n=t,i=1,e&&!n.previousSibling&&u.removeItem(r)}}return r=n,a=i,this.setRange(s,l,r,a),!0},getSelectedElements:function(t){if(!this._resetRangeToTextNode())return[];let n=this.getRange();if(u.isWysiwygDiv(n.startContainer)){const t=e.element.wysiwyg.children;if(0===t.length)return[];this.setRange(t[0],0,t[t.length-1],t[t.length-1].textContent.trim().length),n=this.getRange()}const i=n.startContainer,o=n.endContainer,s=n.commonAncestorContainer,l=u.getListChildren(s,(function(e){return t?t(e):u.isFormatElement(e)}));if(u.isWysiwygDiv(s)||u.isRangeFormatElement(s)||l.unshift(u.getFormatElement(s,null)),i===o||1===l.length)return l;let r=u.getFormatElement(i,null),a=u.getFormatElement(o,null),d=null,c=null;const f=function(e){return!u.isTable(e)||/^TABLE$/i.test(e.nodeName)};let h=u.getRangeFormatElement(r,f),g=u.getRangeFormatElement(a,f);u.isTable(h)&&u.isListCell(h.parentNode)&&(h=h.parentNode),u.isTable(g)&&u.isListCell(g.parentNode)&&(g=g.parentNode);const m=h===g;for(let e,u=0,p=l.length;u<p;u++)if(e=l[u],r===e||!m&&e===h)d=u;else if(a===e||!m&&e===g){c=u;break}return null===d&&(d=0),null===c&&(c=l.length-1),l.slice(d,c+1)},getSelectedElementsAndComponents:function(e){const t=this.getRange().commonAncestorContainer,n=u.getParentElement(t,u.isComponent),i=u.isTable(t)?this.getSelectedElements(null):this.getSelectedElements(function(e){const t=this.getParentElement(e,this.isComponent);return this.isFormatElement(e)&&(!t||t===n)||this.isComponent(e)&&!this.getFormatElement(e)}.bind(u));if(e)for(let o=0,s=i.length;o<s;o++)for(let e=o-1;e>=0;e--)if(i[e].contains(i[o])){i.splice(o,1),o--,s--;break}return i},isEdgePoint:function(e,t,n){return"end"!==n&&0===t||(!n||"front"!==n)&&!e.nodeValue&&1===t||(!n||"end"===n)&&!!e.nodeValue&&t===e.nodeValue.length},_isEdgeFormat:function(e,t,n){if(!this.isEdgePoint(e,t,n))return!1;const i=[];for(n="front"===n?"previousSibling":"nextSibling";e&&!u.isFormatElement(e)&&!u.isWysiwygDiv(e);){if(e[n]&&(!u.isBreak(e[n])||e[n][n]))return null;1===e.nodeType&&i.push(e.cloneNode(!1)),e=e.parentNode}return i},showLoading:function(){e.element.loading.style.display="block"},closeLoading:function(){e.element.loading.style.display="none"},appendFormatTag:function(e,t){if(!e||!e.parentNode)return null;const n=u.getFormatElement(this.getSelectionNode(),null);let i=null;if(u.isFreeFormatElement(n||e.parentNode))i=u.createElement("BR");else{const e=t?"string"===typeof t?t:t.nodeName:!u.isFormatElement(n)||u.isRangeFormatElement(n)||u.isFreeFormatElement(n)?d.defaultTag:n.nodeName;i=u.createElement(e),i.innerHTML="<br>",(t&&"string"!==typeof t||!t&&u.isFormatElement(n))&&u.copyTagAttributes(i,t||n)}return u.isCell(e)?e.insertBefore(i,e.nextElementSibling):e.parentNode.insertBefore(i,e.nextElementSibling),i},insertComponent:function(e,t,n,i){if(this.isReadOnly||n&&!this.checkCharCount(e,null))return null;const o=this.removeNode();this.getRange_addLine(this.getRange(),o.container);let s=null,l=this.getSelectionNode(),r=u.getFormatElement(l,null);if(u.isListCell(r))this.insertNode(e,l===r?null:o.container.nextSibling,!1),e.nextSibling||e.parentNode.appendChild(u.createElement("BR"));else{if(this.getRange().collapsed&&(3===o.container.nodeType||u.isBreak(o.container))){const e=u.getParentElement(o.container,function(e){return this.isRangeFormatElement(e)}.bind(u));s=u.splitElement(o.container,o.offset,e?u.getElementDepth(e)+1:0),s&&(r=s.previousSibling)}this.insertNode(e,u.isRangeFormatElement(r)?null:r,!1),r&&u.onlyZeroWidthSpace(r)&&u.removeItem(r)}if(!i){this.setRange(e,0,e,0);const t=this.getFileComponent(e);t?this.selectComponent(t.target,t.pluginName):s&&(s=u.getEdgeChildNodes(s,null).sc||s,this.setRange(s,0,s,0))}return t||this.history.push(1),s||e},getFileComponent:function(e){if(!this._fileManager.queryString||!e)return null;let t,n;return(/^FIGURE$/i.test(e.nodeName)||/se-component/.test(e.className))&&(t=e.querySelector(this._fileManager.queryString)),!t&&e.nodeName&&this._fileManager.regExp.test(e.nodeName)&&(t=e),t&&(n=this._fileManager.pluginMap[t.nodeName.toLowerCase()],n)?{target:t,component:u.getParentElement(t,u.isComponent),pluginName:n}:null},selectComponent:function(e,t){if(u.isUneditableComponent(u.getParentElement(e,u.isComponent))||u.isUneditableComponent(e))return!1;this.hasFocus||this.focus();const n=this.plugins[t];n&&h.setTimeout(function(){"function"===typeof n.select&&this.callPlugin(t,n.select.bind(this,e),null),this._setComponentLineBreaker(e)}.bind(this))},_setComponentLineBreaker:function(t){this._lineBreaker.style.display="none";const n=u.getParentElement(t,u.isComponent),i=e.element.lineBreaker_t.style,o=e.element.lineBreaker_b.style,s="block"===this.context.resizing.resizeContainer.style.display?this.context.resizing.resizeContainer:t,l=u.isListCell(n.parentNode);let r,a,d;(l?n.previousSibling:u.isFormatElement(n.previousElementSibling))?i.display="none":(this._variable._lineBreakComp=n,a=e.element.wysiwyg.scrollTop,r=u.getOffset(t,e.element.wysiwygFrame).top+a,d=s.offsetWidth/2/2,i.top=r-a-12+"px",i.left=u.getOffset(s).left+d+"px",i.display="block"),(l?n.nextSibling:u.isFormatElement(n.nextElementSibling))?o.display="none":(r||(this._variable._lineBreakComp=n,a=e.element.wysiwyg.scrollTop,r=u.getOffset(t,e.element.wysiwygFrame).top+a,d=s.offsetWidth/2/2),o.top=r+s.offsetHeight-a-12+"px",o.left=u.getOffset(s).left+s.offsetWidth-d-24+"px",o.display="block")},insertNode:function(t,n,i){if(this.isReadOnly||i&&!this.checkCharCount(t,null))return null;const o=u.getFreeFormatElement(this.getSelectionNode(),null),s=!o&&(u.isFormatElement(t)||u.isRangeFormatElement(t))||u.isComponent(t);if(!n&&(s||u.isComponent(t)||u.isMedia(t))){const e=this.removeNode();if(3===e.container.nodeType||u.isBreak(e.container)){const t=u.getParentElement(e.container,function(e){return this.isRangeFormatElement(e)||this.isListCell(e)}.bind(u));(n=u.splitElement(e.container,e.offset,t?u.getElementDepth(t)+1:0))&&(n=n.previousSibling)}}const l=n||s?this.getRange():this.getRange_addLine(this.getRange(),null),r=l.commonAncestorContainer,a=l.startOffset,c=l.endOffset,f=l.startContainer===r&&u.isFormatElement(r),h=f&&(r.childNodes[a]||r.childNodes[0])||l.startContainer,g=f&&(r.childNodes[c]||r.childNodes[r.childNodes.length-1])||l.endContainer;let m,p=null;if(n)m=n.parentNode,n=n.nextSibling,p=!0;else if(m=h,3===h.nodeType&&(m=h.parentNode),l.collapsed)if(3===r.nodeType)n=r.textContent.length>c?r.splitText(c):r.nextSibling;else if(u.isBreak(m))n=m,m=m.parentNode;else{let e=m.childNodes[a];const i=e&&3===e.nodeType&&u.onlyZeroWidthSpace(e)&&u.isBreak(e.nextSibling)?e.nextSibling:e;i?i.nextSibling?n=u.isBreak(i)&&!u.isBreak(t)?i:i.nextSibling:(m.removeChild(i),n=null):n=null}else{if(h===g){n=this.isEdgePoint(g,c)?g.nextSibling:g.splitText(c);let e=h;this.isEdgePoint(h,a)||(e=h.splitText(a)),m.removeChild(e),0===m.childNodes.length&&s&&(m.innerHTML="<br>")}else{const e=this.removeNode(),t=e.container,i=e.prevContainer;if(t&&0===t.childNodes.length&&s&&(u.isFormatElement(t)?t.innerHTML="<br>":u.isRangeFormatElement(t)&&(t.innerHTML="<"+d.defaultTag+"><br></"+d.defaultTag+">")),!s&&i)if(m=3===i.nodeType?i.parentNode:i,m.contains(t)){let e=!0;for(n=t;n.parentNode!==m;)n=n.parentNode,e=!1;e&&t===i&&(n=n.nextSibling)}else n=null;else m=(n=s?g:t===i?t.nextSibling:t)&&n.parentNode?n.parentNode:r;for(;n&&!u.isFormatElement(n)&&n.parentNode!==r;)n=n.parentNode}}try{if((u.isWysiwygDiv(n)||m===e.element.wysiwyg.parentNode)&&(m=e.element.wysiwyg,n=null),u.isFormatElement(t)||u.isRangeFormatElement(t)||!u.isListCell(m)&&u.isComponent(t)){const e=m;if(u.isList(n))m=n,n=null;else if(u.isListCell(n))m=n.previousElementSibling||n;else if(!p&&!n){const e=this.removeNode(),t=3===e.container.nodeType?u.isListCell(u.getFormatElement(e.container,null))?e.container:u.getFormatElement(e.container,null)||e.container.parentNode:e.container,i=u.isWysiwygDiv(t)||u.isRangeFormatElement(t);m=i?t:t.parentNode,n=i?null:t.nextSibling}0===e.childNodes.length&&m!==e&&u.removeItem(e)}if(!s||o||u.isRangeFormatElement(m)||u.isListCell(m)||u.isWysiwygDiv(m)||(n=m.nextElementSibling,m=m.parentNode),u.isWysiwygDiv(m)&&(3===t.nodeType||u.isBreak(t))){const e=u.createElement(d.defaultTag);e.appendChild(t),t=e}m.insertBefore(t,m===n?m.lastChild:n)}catch(y){m.appendChild(t)}finally{if((u.isFormatElement(t)||u.isComponent(t))&&h===g){const e=u.getFormatElement(r,null);e&&1===e.nodeType&&u.isEmptyLine(e)&&u.removeItem(e)}if(o&&(u.isFormatElement(t)||u.isRangeFormatElement(t))&&(t=this._setIntoFreeFormat(t)),!u.isComponent(t)){let e=1;if(3===t.nodeType){const e=t.previousSibling,n=t.nextSibling,i=!e||1===e.nodeType||u.onlyZeroWidthSpace(e)?"":e.textContent,o=!n||1===n.nodeType||u.onlyZeroWidthSpace(n)?"":n.textContent;e&&i.length>0&&(t.textContent=i+t.textContent,u.removeItem(e)),n&&n.length>0&&(t.textContent+=o,u.removeItem(n));const s={container:t,startOffset:i.length,endOffset:t.textContent.length-o.length};return this.setRange(t,s.startOffset,t,s.endOffset),s}if(!u.isBreak(t)&&u.isFormatElement(m)){let n=null;t.previousSibling&&!u.isBreak(t.previousSibling)||(n=u.createTextNode(u.zeroWidthSpace),t.parentNode.insertBefore(n,t)),t.nextSibling&&!u.isBreak(t.nextSibling)||(n=u.createTextNode(u.zeroWidthSpace),t.parentNode.insertBefore(n,t.nextSibling)),u._isIgnoreNodeChange(t)&&(t=t.nextSibling,e=0)}this.setRange(t,e,t,e)}return this.history.push(!0),t}},_setIntoFreeFormat:function(e){const t=e.parentNode;let n,i;for(;u.isFormatElement(e)||u.isRangeFormatElement(e);){for(n=e.childNodes,i=null;n[0];)if(i=n[0],u.isFormatElement(i)||u.isRangeFormatElement(i)){if(this._setIntoFreeFormat(i),!e.parentNode)break;n=e.childNodes}else t.insertBefore(i,e);0===e.childNodes.length&&u.removeItem(e),e=u.createElement("BR"),t.insertBefore(e,i.nextSibling)}return e},removeNode:function(){this._resetRangeToTextNode();const t=this.getRange();let n,i=0,o=t.startContainer,s=t.endContainer,l=t.startOffset,r=t.endOffset;const a=3===t.commonAncestorContainer.nodeType&&t.commonAncestorContainer.parentNode===o.parentNode?o.parentNode:t.commonAncestorContainer;a===o&&a===s&&(o=a.children[l],s=a.children[r],l=r=0);let d=null,c=null;const f=u.getListChildNodes(a,null);let h=u.getArrayIndex(f,o),g=u.getArrayIndex(f,s);if(f.length>0&&h>-1&&g>-1){for(let e=h+1,t=o;e>=0;e--)f[e]===t.parentNode&&f[e].firstChild===t&&0===l&&(h=e,t=t.parentNode);for(let e=g-1,t=s;e>h;e--)f[e]===t.parentNode&&1===f[e].nodeType&&(f.splice(e,1),t=t.parentNode,--g)}else{if(0===f.length){if(u.isFormatElement(a)||u.isRangeFormatElement(a)||u.isWysiwygDiv(a)||u.isBreak(a)||u.isMedia(a))return{container:a,offset:0};if(3===a.nodeType)return{container:a,offset:r};f.push(a),o=s=a}else if(o=s=f[0],u.isBreak(o)||u.onlyZeroWidthSpace(o))return{container:u.isMedia(a)?a:o,offset:0};h=g=0}function m(e){const t=u.getFormatElement(e,null);if(u.removeItem(e),u.isListCell(t)){const e=u.getArrayItem(t.children,u.isList,!1);if(e){const n=e.firstElementChild,i=n.childNodes;for(;i[0];)t.insertBefore(i[0],e);u.removeItemAllParents(n,null,null)}}}for(let e=h;e<=g;e++){const t=f[e];if(0===t.length||3===t.nodeType&&void 0===t.data)m(t);else if(t!==o)if(t!==s)m(t);else{if(1===s.nodeType){if(u.isComponent(s))continue;c=u.createTextNode(s.textContent)}else c=u.createTextNode(s.substringData(r,s.length-r));c.length>0?s.data=c.data:m(s)}else{if(1===o.nodeType){if(u.isComponent(o))continue;d=u.createTextNode(o.textContent)}else t===s?(d=u.createTextNode(o.substringData(0,l)+s.substringData(r,s.length-r)),i=l):d=u.createTextNode(o.substringData(0,l));if(d.length>0?o.data=d.data:m(o),t===s)break}}if(n=s&&s.parentNode?s:o&&o.parentNode?o:t.endContainer||t.startContainer,!u.isWysiwygDiv(n)&&0===n.childNodes.length){const t=u.removeItemAllParents(n,function(e){if(this.isComponent(e))return!1;const t=e.textContent;return 0===t.length||/^(\n|\u200B)+$/.test(t)}.bind(u),null);t&&(n=t.sc||t.ec||e.element.wysiwyg)}return this.setRange(n,i,n,i),this.history.push(!0),{container:n,offset:i,prevContainer:o&&o.parentNode?o:null}},applyRangeFormatElement:function(e){this.getRange_addLine(this.getRange(),null);const t=this.getSelectedElementsAndComponents(!1);if(!t||0===t.length)return;e:for(let f,h,g,m,p,y,C=0,_=t.length;C<_;C++)if(f=t[C],u.isListCell(f))if(h=f.lastElementChild,h&&u.isListCell(f.nextElementSibling)&&t.indexOf(f.nextElementSibling)>-1&&(m=h.lastElementChild,t.indexOf(m)>-1)){let e=null;for(;e=m.lastElementChild;)if(u.isList(e)){if(!(t.indexOf(e.lastElementChild)>-1))continue e;m=e.lastElementChild}g=h.firstElementChild,p=t.indexOf(g),y=t.indexOf(m),t.splice(p,y-p+1),_=t.length}else;let n,i,o,s=t[t.length-1];n=u.isRangeFormatElement(s)||u.isFormatElement(s)?s:u.getRangeFormatElement(s,null)||u.getFormatElement(s,null),u.isCell(n)?(i=null,o=n):(i=n.nextSibling,o=n.parentNode);let l=u.getElementDepth(n),r=null;const a=[],d=function(e,t,n){let i=null;if(e!==t&&!u.isTable(t)){if(t&&u.getElementDepth(e)===u.getElementDepth(t))return n;i=u.removeItemAllParents(t,null,e)}return i?i.ec:n};for(let f,h,g,m,p,y,C,_=0,b=t.length;_<b;_++)if(f=t[_],h=f.parentNode,h&&!e.contains(h))if(g=u.getElementDepth(f),u.isList(h)){if(null===r&&(y?(r=y,C=!0,y=null):r=h.cloneNode(!1)),a.push(f),p=t[_+1],_===b-1||p&&p.parentNode!==h){p&&f.contains(p.parentNode)&&(y=p.parentNode.cloneNode(!1));let t,n=h.parentNode;for(;u.isList(n);)t=u.createElement(n.nodeName),t.appendChild(r),r=t,n=n.parentNode;const s=this.detachRangeFormatElement(h,a,null,!0,!0);l>=g?(l=g,o=s.cc,i=d(o,h,s.ec),i&&(o=i.parentNode)):o===s.cc&&(i=s.ec),o!==s.cc&&(m=d(o,s.cc,m),i=void 0!==m?m:s.cc);for(let e=0,i=s.removeArray.length;e<i;e++)r.appendChild(s.removeArray[e]);C||e.appendChild(r),y&&s.removeArray[s.removeArray.length-1].appendChild(y),r=null,C=!1}}else l>=g&&(l=g,o=h,i=f.nextSibling),e.appendChild(f),o!==h&&(m=d(o,h),void 0!==m&&(i=m));if(this.effectNode=null,u.mergeSameTags(e,null,!1),u.mergeNestedTags(e,function(e){return this.isList(e)}.bind(u)),i&&u.getElementDepth(i)>0&&(u.isList(i.parentNode)||u.isList(i.parentNode.parentNode))){const t=u.getParentElement(i,function(e){return this.isRangeFormatElement(e)&&!this.isList(e)}.bind(u)),n=u.splitElement(i,null,t?u.getElementDepth(t)+1:0);n.parentNode.insertBefore(e,n)}else o.insertBefore(e,i),d(e,i);const c=u.getEdgeChildNodes(e.firstElementChild,e.lastElementChild);t.length>1?this.setRange(c.sc,0,c.ec,c.ec.textContent.length):this.setRange(c.ec,c.ec.textContent.length,c.ec,c.ec.textContent.length),this.history.push(!1)},detachRangeFormatElement:function(e,t,n,i,o){const s=this.getRange(),l=s.startOffset,r=s.endOffset;let a=u.getListChildNodes(e,(function(t){return t.parentNode===e})),c=e.parentNode,f=null,h=null,g=e.cloneNode(!1);const m=[],p=u.isList(n);let y=!1,C=!1,_=!1;function b(t,n,i,o){if(u.onlyZeroWidthSpace(n)&&(n.innerHTML=u.zeroWidthSpace),3===n.nodeType)return t.insertBefore(n,i),n;const s=(_?n:o).childNodes;let l=n.cloneNode(!1),r=null,a=null;for(;s[0];)a=s[0],!u._notTextNode(a)||u.isBreak(a)||u.isListCell(l)?l.appendChild(a):(l.childNodes.length>0&&(r||(r=l),t.insertBefore(l,i),l=n.cloneNode(!1)),t.insertBefore(a,i),r||(r=a));if(l.childNodes.length>0){if(u.isListCell(t)&&u.isListCell(l)&&u.isList(i))if(p){for(r=i;i;)l.appendChild(i),i=i.nextSibling;t.parentNode.insertBefore(l,t.nextElementSibling)}else{const t=o.nextElementSibling,n=u.detachNestedList(o,!1);if(e!==n||t!==o.nextElementSibling){const t=l.childNodes;for(;t[0];)o.appendChild(t[0]);e=n,C=!0}}else t.insertBefore(l,i);r||(r=l)}return r}for(let w,N,x,S=0,B=a.length;S<B;S++)if(w=a[S],3!==w.nodeType||!u.isList(g))if(_=!1,i&&0===S&&(f=t&&t.length!==B&&t[0]!==w?g:e.previousSibling),t&&(N=t.indexOf(w)),t&&-1===N)g||(g=e.cloneNode(!1)),g.appendChild(w);else{if(t&&(x=t[N+1]),g&&g.children.length>0&&(c.insertBefore(g,e),g=null),!p&&u.isListCell(w))if(x&&u.getElementDepth(w)!==u.getElementDepth(x)&&(u.isListCell(c)||u.getArrayItem(w.children,u.isList,!1))){const t=w.nextElementSibling,n=u.detachNestedList(w,!1);e===n&&t===w.nextElementSibling||(e=n,C=!0)}else{const t=w;w=u.createElement(i?t.nodeName:u.isList(e.parentNode)||u.isListCell(e.parentNode)?"LI":u.isCell(e.parentNode)?"DIV":d.defaultTag);const n=u.isListCell(w),o=t.childNodes;for(;o[0]&&(!u.isList(o[0])||n);)w.appendChild(o[0]);u.copyFormatAttributes(w,t),_=!0}else w=w.cloneNode(!1);if(!C&&(i?(m.push(w),u.removeItem(a[S])):(n?(y||(c.insertBefore(n,e),y=!0),w=b(n,w,null,a[S])):w=b(c,w,e,a[S]),C||(t?(h=w,f||(f=w)):f||(f=h=w))),C)){C=_=!1,a=u.getListChildNodes(e,(function(t){return t.parentNode===e})),g=e.cloneNode(!1),c=e.parentNode,S=-1,B=a.length;continue}}const v=e.parentNode;let E=e.nextSibling;g&&g.children.length>0&&v.insertBefore(g,E),n?f=n.previousSibling:f||(f=e.previousSibling),E=e.nextSibling!==g?e.nextSibling:g?g.nextSibling:null,0===e.children.length||0===e.textContent.length?u.removeItem(e):u.removeEmptyNode(e,null);let T=null;if(i)T={cc:v,sc:f,ec:E,removeArray:m};else{f||(f=h),h||(h=f);const e=u.getEdgeChildNodes(f,h.parentNode?f:h);T={cc:(e.sc||e.ec).parentNode,sc:e.sc,ec:e.ec}}if(this.effectNode=null,o)return T;!i&&T&&(t?this.setRange(T.sc,l,T.ec,r):this.setRange(T.sc,0,T.sc,0)),this.history.push(!1)},detachList:function(e,t){let n={},i=!1,o=!1,s=null,l=null;const r=function(e){return!this.isComponent(e)}.bind(u);for(let a,d,c,f,h=0,g=e.length;h<g;h++){if(c=h===g-1,d=u.getRangeFormatElement(e[h],r),f=u.isList(d),!a&&f)a=d,n={r:a,f:[u.getParentElement(e[h],"LI")]},0===h&&(i=!0);else if(a&&f)if(a!==d){const r=this.detachRangeFormatElement(n.f[0].parentNode,n.f,null,t,!0);d=e[h].parentNode,i&&(s=r.sc,i=!1),c&&(l=r.ec),f?(a=d,n={r:a,f:[u.getParentElement(e[h],"LI")]},c&&(o=!0)):a=null}else n.f.push(u.getParentElement(e[h],"LI")),c&&(o=!0);if(c&&u.isList(a)){const e=this.detachRangeFormatElement(n.f[0].parentNode,n.f,null,t,!0);(o||1===g)&&(l=e.ec),i&&(s=e.sc||l)}}return{sc:s,ec:l}},nodeChange:function(e,t,n,i){this._resetRangeToTextNode();let o=this.getRange_addLine(this.getRange(),null);t=!!(t&&t.length>0)&&t,n=!!(n&&n.length>0)&&n;const s=!e,l=s&&!n&&!t;let r=o.startContainer,a=o.startOffset,d=o.endContainer,c=o.endOffset;if(l&&o.collapsed&&u.isFormatElement(r.parentNode)&&u.isFormatElement(d.parentNode)||r===d&&1===r.nodeType&&u.isNonEditable(r))return;if(o.collapsed&&!l&&1===r.nodeType&&!u.isBreak(r)&&!u.isComponent(r)){let e=null;const t=r.childNodes[a];t&&(e=t.nextSibling?u.isBreak(t)?t:t.nextSibling:null);const n=u.createTextNode(u.zeroWidthSpace);r.insertBefore(n,e),this.setRange(n,1,n,1),o=this.getRange(),r=o.startContainer,a=o.startOffset,d=o.endContainer,c=o.endOffset}u.isFormatElement(r)&&(r=r.childNodes[a]||r.firstChild,a=0),u.isFormatElement(d)&&(d=d.childNodes[c]||d.lastChild,c=d.textContent.length),s&&(e=u.createElement("DIV"));const f=h.RegExp,g=e.nodeName;if(!l&&r===d&&!n&&e){let t=r,n=0;const i=[],o=e.style;for(let e=0,s=o.length;e<s;e++)i.push(o[e]);const l=e.classList;for(let e=0,s=l.length;e<s;e++)i.push("."+l[e]);if(i.length>0){for(;!u.isFormatElement(t)&&!u.isWysiwygDiv(t);){for(let o=0;o<i.length;o++)if(1===t.nodeType){const l=i[o],r=!!/^\./.test(l)&&new f("\\s*"+l.replace(/^\./,"")+"(\\s+|$)","ig"),a=s?!!t.style[l]:!!t.style[l]&&!!e.style[l]&&t.style[l]===e.style[l],d=!1!==r&&(s?!!t.className.match(r):!!t.className.match(r)&&!!e.className.match(r));(a||d)&&n++}t=t.parentNode}if(n>=i.length)return}}let m,p={},y={},C="",_="",b="";if(t){for(let e,n=0,i=t.length;n<i;n++)e=t[n],/^\./.test(e)?_+=(_?"|":"\\s*(?:")+e.replace(/^\./,""):C+=(C?"|":"(?:;|^|\\s)(?:")+e;C&&(C+=")\\s*:[^;]*\\s*(?:;|$)",C=new f(C,"ig")),_&&(_+=")(?=\\s+|$)",_=new f(_,"ig"))}if(n){b="^(?:"+n[0];for(let e=1;e<n.length;e++)b+="|"+n[e];b+=")$",b=new f(b,"i")}const v=h.Boolean,E={v:!1},T=function(e){const t=e.cloneNode(!1);if(3===t.nodeType||u.isBreak(t))return t;if(l)return null;const n=!b&&s||b&&b.test(t.nodeName);if(n&&!i)return E.v=!0,null;const o=t.style.cssText;let r="";C&&o.length>0&&(r=o.replace(C,"").trim(),r!==o&&(E.v=!0));const a=t.className;let d="";return _&&a.length>0&&(d=a.replace(_,"").trim(),d!==a&&(E.v=!0)),(!s||!_&&a||!C&&o||r||d||!n)&&(r||d||t.nodeName!==g||v(C)!==v(o)||v(_)!==v(a))?(C&&o.length>0&&(t.style.cssText=r),t.style.cssText||t.removeAttribute("style"),_&&a.length>0&&(t.className=d.trim()),t.className.trim()||t.removeAttribute("class"),t.style.cssText||t.className||t.nodeName!==g&&!n?t:(E.v=!0,null)):(E.v=!0,null)},w=this.getSelectedElements(null);o=this.getRange(),r=o.startContainer,a=o.startOffset,d=o.endContainer,c=o.endOffset,u.getFormatElement(r,null)||(r=u.getChildElement(w[0],(function(e){return 3===e.nodeType}),!1),a=0),u.getFormatElement(d,null)||(d=u.getChildElement(w[w.length-1],(function(e){return 3===e.nodeType}),!1),c=d.textContent.length);const N=u.getFormatElement(r,null)===u.getFormatElement(d,null),x=w.length-(N?0:1);m=e.cloneNode(!1);const S=l||s&&function(e){for(let t=0,n=e.length;t<n;t++)if(u._isMaintainedNode(e[t])||u._isSizeNode(e[t]))return!0;return!1}(n),B=s||u._isSizeNode(m),k=this._util_getMaintainedNode.bind(u,S,B),L=this._util_isMaintainedNode.bind(u,S,B);if(N){const e=this._nodeChange_oneLine(w[0],m,T,r,a,d,c,l,s,o.collapsed,E,k,L);p.container=e.startContainer,p.offset=e.startOffset,y.container=e.endContainer,y.offset=e.endOffset,p.container===y.container&&u.onlyZeroWidthSpace(p.container)&&(p.offset=y.offset=1),this._setCommonListStyle(e.ancestor,null)}else{x>0&&(m=e.cloneNode(!1),y=this._nodeChange_endLine(w[x],m,T,d,c,l,s,E,k,L));for(let t,n=x-1;n>0;n--)m=e.cloneNode(!1),t=this._nodeChange_middleLine(w[n],m,T,l,s,E,y.container),t.endContainer&&t.ancestor.contains(t.endContainer)&&(y.ancestor=null,y.container=t.endContainer),this._setCommonListStyle(t.ancestor,null);m=e.cloneNode(!1),p=this._nodeChange_startLine(w[0],m,T,r,a,l,s,E,k,L,y.container),p.endContainer&&(y.ancestor=null,y.container=p.endContainer),x<=0?y=p:y.container||(y.ancestor=null,y.container=p.container,y.offset=p.container.textContent.length),this._setCommonListStyle(p.ancestor,null),this._setCommonListStyle(y.ancestor||u.getFormatElement(y.container),null)}this.controllersOff(),this.setRange(p.container,p.offset,y.container,y.offset),this.history.push(!1)},_setCommonListStyle:function(e,t){if(!u.isListCell(e))return;t||e.removeAttribute("style");const n=u.getArrayItem((t||e).childNodes,(function(e){return!u.isBreak(e)}),!0);if(n[0]&&1===n.length){if(!(t=n[0])||1!==t.nodeType)return;const i=t.style,o=e.style;d._textTagsMap[t.nodeName.toLowerCase()]===this._defaultCommand.bold.toLowerCase()?o.fontWeight="bold":i.fontWeight&&(o.fontWeight=i.fontWeight),d._textTagsMap[t.nodeName.toLowerCase()]===this._defaultCommand.italic.toLowerCase()?o.fontStyle="italic":i.fontStyle&&(o.fontStyle=i.fontStyle),i.color&&(o.color=i.color),i.fontSize&&(o.fontSize=i.fontSize),this._setCommonListStyle(e,t)}},_stripRemoveNode:function(e){const t=e.parentNode;if(!e||3===e.nodeType||!t)return;const n=e.childNodes;for(;n[0];)t.insertBefore(n[0],e);t.removeChild(e)},_util_getMaintainedNode:function(e,t,n){return!n||e?null:this.getParentElement(n,this._isMaintainedNode.bind(this))||(t?null:this.getParentElement(n,this._isSizeNode.bind(this)))},_util_isMaintainedNode:function(e,t,n){if(!n||e||1!==n.nodeType)return!1;const i=this._isMaintainedNode(n);return this.getParentElement(n,this._isMaintainedNode.bind(this))?i:i||!t&&this._isSizeNode(n)},_nodeChange_oneLine:function(e,t,n,i,o,s,l,r,a,d,c,f,g){let m=i.parentNode;for(;!m.nextSibling&&!m.previousSibling&&!u.isFormatElement(m.parentNode)&&!u.isWysiwygDiv(m.parentNode)&&m.nodeName!==t.nodeName;)m=m.parentNode;if(!a&&m===s.parentNode&&m.nodeName===t.nodeName&&u.onlyZeroWidthSpace(i.textContent.slice(0,o))&&u.onlyZeroWidthSpace(s.textContent.slice(l))){const e=m.childNodes;let n=!0;for(let t,o,l,r,a=0,d=e.length;a<d;a++)if(t=e[a],r=!u.onlyZeroWidthSpace(t),t!==i)if(t!==s){if(!o&&r||o&&l&&r){n=!1;break}}else l=!0;else o=!0;if(n)return u.copyTagAttributes(m,t),{startContainer:i,startOffset:o,endContainer:s,endOffset:l}}c.v=!1;const p=e,y=[t],C=e.cloneNode(!1),_=i===s;let b,v,E,T,w,N=i,x=o,S=s,B=l,k=!1,L=!1;const R=h.RegExp;function O(e){const t=new R("(?:;|^|\\s)(?:"+T+"null)\\s*:[^;]*\\s*(?:;|$)","ig");let n="";return t&&e.style.cssText.length>0&&(n=t.test(e.style.cssText)),!n}if(function e(i,o){const s=i.childNodes;for(let l,a=0,c=s.length;a<c;a++){let i=s[a];if(!i)continue;let c,h=o;if(!k&&i===N){let e=C;w=f(i);const s=u.createTextNode(1===N.nodeType?"":N.substringData(0,x)),r=u.createTextNode(1===N.nodeType?"":N.substringData(x,_&&B>=x?B-x:N.data.length-x));if(w){const t=f(o);if(t&&t.parentNode!==e){let n=t,i=null;for(;n.parentNode!==e;){for(o=i=n.parentNode.cloneNode(!1);n.childNodes[0];)i.appendChild(n.childNodes[0]);n.appendChild(i),n=n.parentNode}n.parentNode.appendChild(t)}w=w.cloneNode(!1)}u.onlyZeroWidthSpace(s)||o.appendChild(s);const a=f(o);for(a&&(w=a),w&&(e=w),v=i,b=[],T="";v!==e&&v!==p&&null!==v;)l=g(v)?null:n(v),l&&1===v.nodeType&&O(v)&&(b.push(l),T+=v.style.cssText.substr(0,v.style.cssText.indexOf(":"))+"|"),v=v.parentNode;const d=b.pop()||r;for(E=v=d;b.length>0;)v=b.pop(),E.appendChild(v),E=v;if(t.appendChild(d),e.appendChild(t),w&&!f(S)&&(t=t.cloneNode(!1),C.appendChild(t),y.push(t)),N=r,x=0,k=!0,v!==r&&v.appendChild(N),!_)continue}if(L||i!==S){if(k){if(1===i.nodeType&&!u.isBreak(i)){u._isIgnoreNodeChange(i)?(C.appendChild(i.cloneNode(!0)),d||(t=t.cloneNode(!1),C.appendChild(t),y.push(t))):e(i,i);continue}v=i,b=[],T="";const s=[];for(;null!==v.parentNode&&v!==p&&v!==t;)l=L?v.cloneNode(!1):n(v),1===v.nodeType&&!u.isBreak(i)&&l&&O(v)&&(g(v)?w||s.push(l):b.push(l),T+=v.style.cssText.substr(0,v.style.cssText.indexOf(":"))+"|"),v=v.parentNode;b=b.concat(s);const r=b.pop()||i;for(E=v=r;b.length>0;)v=b.pop(),E.appendChild(v),E=v;if(!g(t.parentNode)||g(r)||u.onlyZeroWidthSpace(t)||(t=t.cloneNode(!1),C.appendChild(t),y.push(t)),L||w||!g(r))r===i?o=L?C:t:L?(C.appendChild(r),o=v):(t.appendChild(r),o=v);else{t=t.cloneNode(!1);const e=r.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);r.appendChild(t),C.appendChild(r),y.push(t),o=t.children.length>0?v:t}if(w&&3===i.nodeType)if(f(i)){const e=u.getParentElement(o,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===C}.bind(u));w.appendChild(e),t=e.cloneNode(!1),y.push(t),C.appendChild(t)}else w=null}c=i.cloneNode(!1),o.appendChild(c),1!==i.nodeType||u.isBreak(i)||(h=c),e(i,h)}else{w=f(i);const e=u.createTextNode(1===S.nodeType?"":S.substringData(B,S.length-B)),o=u.createTextNode(_||1===S.nodeType?"":S.substringData(0,B));if(w?w=w.cloneNode(!1):g(t.parentNode)&&!w&&(t=t.cloneNode(!1),C.appendChild(t),y.push(t)),!u.onlyZeroWidthSpace(e)){v=i,T="",b=[];const t=[];for(;v!==C&&v!==p&&null!==v;)1===v.nodeType&&O(v)&&(g(v)?t.push(v.cloneNode(!1)):b.push(v.cloneNode(!1)),T+=v.style.cssText.substr(0,v.style.cssText.indexOf(":"))+"|"),v=v.parentNode;for(b=b.concat(t),c=E=v=b.pop()||e;b.length>0;)v=b.pop(),E.appendChild(v),E=v;C.appendChild(c),v.textContent=e.data}if(w&&c){const e=f(c);e&&(w=e)}for(v=i,b=[],T="";v!==C&&v!==p&&null!==v;)l=g(v)?null:n(v),l&&1===v.nodeType&&O(v)&&(b.push(l),T+=v.style.cssText.substr(0,v.style.cssText.indexOf(":"))+"|"),v=v.parentNode;const s=b.pop()||o;for(E=v=s;b.length>0;)v=b.pop(),E.appendChild(v),E=v;w?((t=t.cloneNode(!1)).appendChild(s),w.insertBefore(t,w.firstChild),C.appendChild(w),y.push(t),w=null):t.appendChild(s),S=o,B=o.data.length,L=!0,!r&&d&&(t=o,o.textContent=u.zeroWidthSpace),v!==o&&v.appendChild(S)}}}(e,C),a&&!r&&!c.v)return{ancestor:e,startContainer:i,startOffset:o,endContainer:s,endOffset:l};if(r=r&&a)for(let h=0;h<y.length;h++){let e,t,n,i=y[h];if(d)e=u.createTextNode(u.zeroWidthSpace),C.replaceChild(e,i);else{const e=i.childNodes;for(t=e[0];e[0];)n=e[0],C.insertBefore(n,i);u.removeItem(i)}0===h&&(d?N=S=e:(N=t,S=n))}else{if(a)for(let e=0;e<y.length;e++)this._stripRemoveNode(y[e]);d&&(N=S=t)}u.removeEmptyNode(C,t),d&&(x=N.textContent.length,B=S.textContent.length);const F=r||0===S.textContent.length;u.isBreak(S)||0!==S.textContent.length||(u.removeItem(S),S=N),B=F?S.textContent.length:B;const D={s:0,e:0},A=u.getNodePath(N,C,D),I=!S.parentNode;I&&(S=N);const M={s:0,e:0},P=u.getNodePath(S,C,I||F?null:M);x+=D.s,B=d?x:I?N.textContent.length:F?B+D.s:B+M.s;const H=u.mergeSameTags(C,[A,P],!0);return e.parentNode.replaceChild(C,e),N=u.getNodeFromPath(A,C),S=u.getNodeFromPath(P,C),{ancestor:C,startContainer:N,startOffset:x+H[0],endContainer:S,endOffset:B+H[1]}},_nodeChange_startLine:function(e,t,n,i,o,s,l,r,a,d,c){let f=i.parentNode;for(;!f.nextSibling&&!f.previousSibling&&!u.isFormatElement(f.parentNode)&&!u.isWysiwygDiv(f.parentNode)&&f.nodeName!==t.nodeName;)f=f.parentNode;if(!l&&f.nodeName===t.nodeName&&!u.isFormatElement(f)&&!f.nextSibling&&u.onlyZeroWidthSpace(i.textContent.slice(0,o))){let n=!0,s=i.previousSibling;for(;s;){if(!u.onlyZeroWidthSpace(s)){n=!1;break}s=s.previousSibling}if(n)return u.copyTagAttributes(f,t),{ancestor:e,container:i,offset:o}}r.v=!1;const h=e,g=[t],m=e.cloneNode(!1);let p,y,C,_,b=i,v=o,E=!1;if(function e(i,o){const s=i.childNodes;for(let l,r,f=0,T=s.length;f<T;f++){const i=s[f];if(!i)continue;let T=o;if(E&&!u.isBreak(i)){if(1===i.nodeType){if(u._isIgnoreNodeChange(i)){if(t=t.cloneNode(!1),r=i.cloneNode(!0),m.appendChild(r),m.appendChild(t),g.push(t),c&&i.contains(c)){const e=u.getNodePath(c,i);c=u.getNodeFromPath(e,r)}}else e(i,i);continue}y=i,p=[];const s=[];for(;null!==y.parentNode&&y!==h&&y!==t;)l=n(y),1===y.nodeType&&l&&(d(y)?_||s.push(l):p.push(l)),y=y.parentNode;p=p.concat(s);const f=p.length>0,b=p.pop()||i;for(C=y=b;p.length>0;)y=p.pop(),C.appendChild(y),C=y;if(d(t.parentNode)&&!d(b)&&(t=t.cloneNode(!1),m.appendChild(t),g.push(t)),!_&&d(b)){t=t.cloneNode(!1);const e=b.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);b.appendChild(t),m.appendChild(b),o=d(y)?t:y,g.push(t)}else f?(t.appendChild(b),o=y):o=t;if(_&&3===i.nodeType)if(a(i)){const e=u.getParentElement(o,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===m}.bind(u));_.appendChild(e),t=e.cloneNode(!1),g.push(t),m.appendChild(t)}else _=null}if(E||i!==b)l=E?n(i):i.cloneNode(!1),l&&(o.appendChild(l),1!==i.nodeType||u.isBreak(i)||(T=l)),e(i,T);else{let e=m;_=a(i);const s=u.createTextNode(1===b.nodeType?"":b.substringData(0,v)),r=u.createTextNode(1===b.nodeType?"":b.substringData(v,b.length-v));if(_){const t=a(o);if(t&&t.parentNode!==e){let n=t,i=null;for(;n.parentNode!==e;){for(o=i=n.parentNode.cloneNode(!1);n.childNodes[0];)i.appendChild(n.childNodes[0]);n.appendChild(i),n=n.parentNode}n.parentNode.appendChild(t)}_=_.cloneNode(!1)}u.onlyZeroWidthSpace(s)||o.appendChild(s);const d=a(o);for(d&&(_=d),_&&(e=_),y=o,p=[];y!==e&&null!==y;)l=n(y),1===y.nodeType&&l&&p.push(l),y=y.parentNode;const c=p.pop()||o;for(C=y=c;p.length>0;)y=p.pop(),C.appendChild(y),C=y;c!==o?(t.appendChild(c),o=y):o=t,u.isBreak(i)&&t.appendChild(i.cloneNode(!1)),e.appendChild(t),b=r,v=0,E=!0,o.appendChild(b)}}}(e,m),l&&!s&&!r.v)return{ancestor:e,container:i,offset:o,endContainer:c};if(s=s&&l)for(let T=0;T<g.length;T++){let e=g[T];const t=e.childNodes,n=t[0];for(;t[0];)m.insertBefore(t[0],e);u.removeItem(e),0===T&&(b=n)}else if(l){t=t.firstChild;for(let e=0;e<g.length;e++)this._stripRemoveNode(g[e])}if(s||0!==m.childNodes.length){u.removeEmptyNode(m,t),u.onlyZeroWidthSpace(m.textContent)&&(b=m.firstChild,v=0);const n={s:0,e:0},i=u.getNodePath(b,m,n);v+=n.s;const o=u.mergeSameTags(m,[i],!0);e.parentNode.replaceChild(m,e),b=u.getNodeFromPath(i,m),v+=o[0]}else e.childNodes?b=e.childNodes[0]:(b=u.createTextNode(u.zeroWidthSpace),e.appendChild(b));return{ancestor:m,container:b,offset:v,endContainer:c}},_nodeChange_middleLine:function(e,t,n,i,o,s,l){if(!o){let n=null;l&&e.contains(l)&&(n=u.getNodePath(l,e));const i=e.cloneNode(!0),o=t.nodeName,s=t.style.cssText,r=t.className;let a,d=i.childNodes,c=0,f=d.length;for(;c<f&&(a=d[c],3!==a.nodeType);c++){if(a.nodeName!==o){if(!u.isBreak(a)&&u._isIgnoreNodeChange(a))continue;if(1===f){d=a.childNodes,f=d.length,c=-1;continue}break}a.style.cssText+=s,u.addClass(a,r)}if(f>0&&c===f)return e.innerHTML=i.innerHTML,{ancestor:e,endContainer:n?u.getNodeFromPath(n,e):null}}s.v=!1;const r=e.cloneNode(!1),a=[t];let d=!0;if(function e(i,o){const s=i.childNodes;for(let c,f,h=0,g=s.length;h<g;h++){let i=s[h];if(!i)continue;let g=o;if(u.isBreak(i)||!u._isIgnoreNodeChange(i))c=n(i),c&&(d=!1,o.appendChild(c),1===i.nodeType&&(g=c)),u.isBreak(i)||e(i,g);else if(t.childNodes.length>0&&(r.appendChild(t),t=t.cloneNode(!1)),f=i.cloneNode(!0),r.appendChild(f),r.appendChild(t),a.push(t),o=t,l&&i.contains(l)){const e=u.getNodePath(l,i);l=u.getNodeFromPath(e,f)}}}(e,t),d||o&&!i&&!s.v)return{ancestor:e,endContainer:l};if(r.appendChild(t),i&&o)for(let c=0;c<a.length;c++){let e=a[c];const t=e.childNodes;for(;t[0];)r.insertBefore(t[0],e);u.removeItem(e)}else if(o){t=t.firstChild;for(let e=0;e<a.length;e++)this._stripRemoveNode(a[e])}return u.removeEmptyNode(r,t),u.mergeSameTags(r,null,!0),e.parentNode.replaceChild(r,e),{ancestor:r,endContainer:l}},_nodeChange_endLine:function(e,t,n,i,o,s,l,r,a,d){let c=i.parentNode;for(;!c.nextSibling&&!c.previousSibling&&!u.isFormatElement(c.parentNode)&&!u.isWysiwygDiv(c.parentNode)&&c.nodeName!==t.nodeName;)c=c.parentNode;if(!l&&c.nodeName===t.nodeName&&!u.isFormatElement(c)&&!c.previousSibling&&u.onlyZeroWidthSpace(i.textContent.slice(o))){let n=!0,s=i.nextSibling;for(;s;){if(!u.onlyZeroWidthSpace(s)){n=!1;break}s=s.nextSibling}if(n)return u.copyTagAttributes(c,t),{ancestor:e,container:i,offset:o}}r.v=!1;const f=e,h=[t],g=e.cloneNode(!1);let m,p,y,C,_=i,b=o,v=!1;if(function e(i,o){const s=i.childNodes;for(let l,r=s.length-1;0<=r;r--){const i=s[r];if(!i)continue;let c=o;if(v&&!u.isBreak(i)){if(1===i.nodeType){if(u._isIgnoreNodeChange(i)){t=t.cloneNode(!1);const e=i.cloneNode(!0);g.insertBefore(e,o),g.insertBefore(t,e),h.push(t)}else e(i,i);continue}p=i,m=[];const s=[];for(;null!==p.parentNode&&p!==f&&p!==t;)l=n(p),l&&1===p.nodeType&&(d(p)?C||s.push(l):m.push(l)),p=p.parentNode;m=m.concat(s);const r=m.length>0,c=m.pop()||i;for(y=p=c;m.length>0;)p=m.pop(),y.appendChild(p),y=p;if(d(t.parentNode)&&!d(c)&&(t=t.cloneNode(!1),g.insertBefore(t,g.firstChild),h.push(t)),!C&&d(c)){t=t.cloneNode(!1);const e=c.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);c.appendChild(t),g.insertBefore(c,g.firstChild),h.push(t),o=t.children.length>0?p:t}else r?(t.insertBefore(c,t.firstChild),o=p):o=t;if(C&&3===i.nodeType)if(a(i)){const e=u.getParentElement(o,function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===g}.bind(u));C.appendChild(e),t=e.cloneNode(!1),h.push(t),g.insertBefore(t,g.firstChild)}else C=null}if(v||i!==_)l=v?n(i):i.cloneNode(!1),l&&(o.insertBefore(l,o.firstChild),1!==i.nodeType||u.isBreak(i)||(c=l)),e(i,c);else{C=a(i);const e=u.createTextNode(1===_.nodeType?"":_.substringData(b,_.length-b)),s=u.createTextNode(1===_.nodeType?"":_.substringData(0,b));if(C){C=C.cloneNode(!1);const e=a(o);if(e&&e.parentNode!==g){let t=e,n=null;for(;t.parentNode!==g;){for(o=n=t.parentNode.cloneNode(!1);t.childNodes[0];)n.appendChild(t.childNodes[0]);t.appendChild(n),t=t.parentNode}t.parentNode.insertBefore(e,t.parentNode.firstChild)}C=C.cloneNode(!1)}else d(t.parentNode)&&!C&&(t=t.cloneNode(!1),g.appendChild(t),h.push(t));for(u.onlyZeroWidthSpace(e)||o.insertBefore(e,o.firstChild),p=o,m=[];p!==g&&null!==p;)l=d(p)?null:n(p),l&&1===p.nodeType&&m.push(l),p=p.parentNode;const r=m.pop()||o;for(y=p=r;m.length>0;)p=m.pop(),y.appendChild(p),y=p;r!==o?(t.insertBefore(r,t.firstChild),o=p):o=t,u.isBreak(i)&&t.appendChild(i.cloneNode(!1)),C?(C.insertBefore(t,C.firstChild),g.insertBefore(C,g.firstChild),C=null):g.insertBefore(t,g.firstChild),_=s,b=s.data.length,v=!0,o.insertBefore(_,o.firstChild)}}}(e,g),l&&!s&&!r.v)return{ancestor:e,container:i,offset:o};if(s=s&&l)for(let E=0;E<h.length;E++){let e=h[E];const t=e.childNodes;let n=null;for(;t[0];)n=t[0],g.insertBefore(n,e);u.removeItem(e),E===h.length-1&&(_=n,b=n.textContent.length)}else if(l){t=t.firstChild;for(let e=0;e<h.length;e++)this._stripRemoveNode(h[e])}if(s||0!==g.childNodes.length){if(!l&&0===t.textContent.length)return u.removeEmptyNode(g,null),{ancestor:null,container:null,offset:0};u.removeEmptyNode(g,t),u.onlyZeroWidthSpace(g.textContent)?(_=g.firstChild,b=_.textContent.length):u.onlyZeroWidthSpace(_)&&(_=t,b=1);const n={s:0,e:0},i=u.getNodePath(_,g,n);b+=n.s;const o=u.mergeSameTags(g,[i],!0);e.parentNode.replaceChild(g,e),_=u.getNodeFromPath(i,g),b+=o[0]}else e.childNodes?_=e.childNodes[0]:(_=u.createTextNode(u.zeroWidthSpace),e.appendChild(_));return{ancestor:g,container:_,offset:1===_.nodeType&&1===b?_.childNodes.length:b}},actionCall:function(t,n,i){if(n){if(/more/i.test(n)){if(i!==this._moreLayerActiveButton){const n=e.element.toolbar.querySelector("."+t);n&&(this._moreLayerActiveButton&&this.moreLayerOff(),this._moreLayerActiveButton=i,n.style.display="block",p._showToolbarBalloon(),p._showToolbarInline()),u.addClass(i,"on")}else{e.element.toolbar.querySelector("."+this._moreLayerActiveButton.getAttribute("data-command"))&&(this.moreLayerOff(),p._showToolbarBalloon(),p._showToolbarInline())}return}if(/container/.test(n)&&(null===this._menuTray[t]||i!==this.containerActiveButton))return void this.callPlugin(t,this.containerOn.bind(this,i),i);if(this.isReadOnly&&u.arrayIncludes(this.resizingDisabledButtons,i))return;if(/submenu/.test(n)&&(null===this._menuTray[t]||i!==this.submenuActiveButton))return void this.callPlugin(t,this.submenuOn.bind(this,i),i);if(/dialog/.test(n))return void this.callPlugin(t,this.plugins[t].open.bind(this),i);/command/.test(n)?this.callPlugin(t,this.plugins[t].action.bind(this),i):/fileBrowser/.test(n)&&this.callPlugin(t,this.plugins[t].open.bind(this,null),i)}else t&&this.commandHandler(i,t);/submenu/.test(n)?this.submenuOff():/command/.test(n)||(this.submenuOff(),this.containerOff())},commandHandler:function(t,n){if(!m.isReadOnly||/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(n))switch(n){case"copy":case"cut":this.execCommand(n);break;case"paste":break;case"selectAll":this.containerOff();const i=e.element.wysiwyg;let o=u.getChildElement(i.firstChild,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!1)||i.firstChild,s=u.getChildElement(i.lastChild,(function(e){return 0===e.childNodes.length||3===e.nodeType}),!0)||i.lastChild;if(!o||!s)return;if(u.isMedia(o)){const e=this.getFileComponent(o),t=u.createElement("BR"),n=u.createElement(d.defaultTag);n.appendChild(t),o=e?e.component:o,o.parentNode.insertBefore(n,o),o=t}if(u.isMedia(s)){const e=u.createElement("BR"),t=u.createElement(d.defaultTag);t.appendChild(e),i.appendChild(t),s=e}this.setRange(o,0,s,s.textContent.length);break;case"codeView":this.toggleCodeView();break;case"fullScreen":this.toggleFullScreen(t);break;case"indent":case"outdent":this.indent(n);break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"removeFormat":this.removeFormat(),this.focus();break;case"print":this.print();break;case"preview":this.preview();break;case"showBlocks":this.toggleDisplayBlocks();break;case"dir":this.setDir(d.rtl?"ltr":"rtl");break;case"dir_ltr":this.setDir("ltr");break;case"dir_rtl":this.setDir("rtl");break;case"save":if("function"===typeof d.callBackSave)d.callBackSave(this.getContents(!1),this._variable.isChanged);else{if(!this._variable.isChanged||"function"!==typeof y.save)throw Error("[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)");y.save()}this._variable.isChanged=!1,e.tool.save&&e.tool.save.setAttribute("disabled",!0);break;default:n=this._defaultCommand[n.toLowerCase()]||n,this.commandMap[n]||(this.commandMap[n]=t);const l=this._variable.currentNodesMap,r=l.indexOf(n)>-1?null:u.createElement(n);let a=n;/^SUB$/i.test(n)&&l.indexOf("SUP")>-1?a="SUP":/^SUP$/i.test(n)&&l.indexOf("SUB")>-1&&(a="SUB"),this.nodeChange(r,this._commandMapStyles[n]||null,[a],!1),this.focus()}},removeFormat:function(){this.nodeChange(null,null,null,null)},indent:function(e){const t=this.getRange(),n=this.getSelectedElements(null),i=[],o="indent"!==e,s=d.rtl?"marginRight":"marginLeft";let l=t.startContainer,r=t.endContainer,a=t.startOffset,c=t.endOffset;for(let d,f,h=0,g=n.length;h<g;h++)d=n[h],u.isListCell(d)&&this.plugins.list?(o||d.previousElementSibling)&&i.push(d):(f=/\d+/.test(d.style[s])?u.getNumber(d.style[s],0):0,o?f-=25:f+=25,u.setStyle(d,s,f<=0?"":f+"px"));i.length>0&&this.plugins.list.editInsideList.call(this,o,i),this.effectNode=null,this.setRange(l,a,r,c),this.history.push(!1)},toggleDisplayBlocks:function(){const t=e.element.wysiwyg;u.toggleClass(t,"se-show-block"),u.hasClass(t,"se-show-block")?u.addClass(this._styleCommandMap.showBlocks,"active"):u.removeClass(this._styleCommandMap.showBlocks,"active"),this._resourcesStateChange()},toggleCodeView:function(){const t=this._variable.isCodeView;this.controllersOff(),u.setDisabledButtons(!t,this.codeViewDisabledButtons),t?(u.isNonEditable(e.element.wysiwygFrame)||this._setCodeDataToEditor(),e.element.wysiwygFrame.scrollTop=0,e.element.code.style.display="none",e.element.wysiwygFrame.style.display="block",this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),"auto"!==d.height||d.codeMirrorEditor||(e.element.code.style.height="0px"),this._variable.isCodeView=!1,this._variable.isFullScreen||(this._notHideToolbar=!1,/balloon|balloon-always/i.test(d.mode)&&(e.element._arrow.style.display="",this._isInline=!1,this._isBalloon=!0,p._hideToolbar())),this.nativeFocus(),u.removeClass(this._styleCommandMap.codeView,"active"),u.isNonEditable(e.element.wysiwygFrame)||(this.history.push(!1),this.history._resetCachingButton())):(this._setEditorDataToCodeView(),this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),this._variable.isFullScreen?e.element.code.style.height="100%":"auto"!==d.height||d.codeMirrorEditor||(e.element.code.style.height=e.element.code.scrollHeight>0?e.element.code.scrollHeight+"px":"auto"),d.codeMirrorEditor&&d.codeMirrorEditor.refresh(),this._variable.isCodeView=!0,this._variable.isFullScreen||(this._notHideToolbar=!0,this._isBalloon&&(e.element._arrow.style.display="none",e.element.toolbar.style.left="",this._isInline=!0,this._isBalloon=!1,p._showToolbarInline())),this._variable._range=null,e.element.code.focus(),u.addClass(this._styleCommandMap.codeView,"active")),this._checkPlaceholder(),this.isReadOnly&&u.setDisabledButtons(!0,this.resizingDisabledButtons),"function"===typeof y.toggleCodeView&&y.toggleCodeView(this._variable.isCodeView,this)},_setCodeDataToEditor:function(){const t=this._getCodeView();if(d.fullPage){const e=this._parser.parseFromString(t,"text/html"),n=e.head.children;for(let t=0,s=n.length;t<s;t++)/^script$/i.test(n[t].tagName)&&(e.head.removeChild(n[t]),t--,s--);let i=e.head.innerHTML;e.head.querySelector('link[rel="stylesheet"]')&&("auto"!==this.options.height||e.head.querySelector("style"))||(i+=u._setIframeCssTags(this.options)),this._wd.head.innerHTML=i,this._wd.body.innerHTML=this.convertContentsForEditor(e.body.innerHTML);const o=e.body.attributes;for(let t=0,s=o.length;t<s;t++)"contenteditable"!==o[t].name&&this._wd.body.setAttribute(o[t].name,o[t].value);if(!u.hasClass(this._wd.body,"sun-editor-editable")){const e=d._editableClass.split(" ");for(let t=0;t<e.length;t++)u.addClass(this._wd.body,d._editableClass[t])}}else e.element.wysiwyg.innerHTML=t.length>0?this.convertContentsForEditor(t):"<"+d.defaultTag+"><br></"+d.defaultTag+">"},_setEditorDataToCodeView:function(){const t=this.convertHTMLForCodeView(e.element.wysiwyg,!1);let n="";if(d.fullPage){const e=u.getAttributesToString(this._wd.body,null);n="<!DOCTYPE html>\n<html>\n"+this._wd.head.outerHTML.replace(/>(?!\n)/g,">\n")+"<body "+e+">\n"+t+"</body>\n</html>"}else n=t;e.element.code.style.display="block",e.element.wysiwygFrame.style.display="none",this._setCodeView(n)},toggleFullScreen:function(t){const n=e.element.topArea,i=e.element.toolbar,o=e.element.editorArea,s=e.element.wysiwygFrame,l=e.element.code,r=this._variable;this.controllersOff();const a="none"===i.style.display||this._isInline&&!this._inlineToolbarAttr.isShow;r.isFullScreen?(r.isFullScreen=!1,s.style.cssText=r._wysiwygOriginCssText,l.style.cssText=r._codeOriginCssText,i.style.cssText="",o.style.cssText=r._editorAreaOriginCssText,n.style.cssText=r._originCssText,f.body.style.overflow=r._bodyOverflow,"auto"!==d.height||d.codeMirrorEditor||p._codeViewAutoHeight(),d.toolbarContainer&&d.toolbarContainer.appendChild(i),d.stickyToolbar>-1&&u.removeClass(i,"se-toolbar-sticky"),r._fullScreenAttrs.sticky&&!d.toolbarContainer&&(r._fullScreenAttrs.sticky=!1,e.element._stickyDummy.style.display="block",u.addClass(i,"se-toolbar-sticky")),this._isInline=r._fullScreenAttrs.inline,this._isBalloon=r._fullScreenAttrs.balloon,this._isInline&&p._showToolbarInline(),d.toolbarContainer&&u.removeClass(i,"se-toolbar-balloon"),p.onScroll_window(),t&&u.changeElement(t.firstElementChild,g.expansion),e.element.topArea.style.marginTop="",u.removeClass(this._styleCommandMap.fullScreen,"active")):(r.isFullScreen=!0,r._fullScreenAttrs.inline=this._isInline,r._fullScreenAttrs.balloon=this._isBalloon,(this._isInline||this._isBalloon)&&(this._isInline=!1,this._isBalloon=!1),d.toolbarContainer&&e.element.relative.insertBefore(i,o),n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.maxWidth="100%",n.style.height="100%",n.style.zIndex="2147483647",""!==e.element._stickyDummy.style.display&&(r._fullScreenAttrs.sticky=!0,e.element._stickyDummy.style.display="none",u.removeClass(i,"se-toolbar-sticky")),r._bodyOverflow=f.body.style.overflow,f.body.style.overflow="hidden",r._editorAreaOriginCssText=o.style.cssText,r._wysiwygOriginCssText=s.style.cssText,r._codeOriginCssText=l.style.cssText,o.style.cssText=i.style.cssText="",s.style.cssText=(s.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0],l.style.cssText=(l.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0],i.style.width=s.style.height=l.style.height="100%",i.style.position="relative",i.style.display="block",r.innerHeight_fullScreen=h.innerHeight-i.offsetHeight,o.style.height=r.innerHeight_fullScreen-d.fullScreenOffset+"px",t&&u.changeElement(t.firstElementChild,g.reduction),d.iframe&&"auto"===d.height&&(o.style.overflow="auto",this._iframeAutoHeight()),e.element.topArea.style.marginTop=d.fullScreenOffset+"px",u.addClass(this._styleCommandMap.fullScreen,"active")),a&&y.toolbar.hide(),"function"===typeof y.toggleFullScreen&&y.toggleFullScreen(this._variable.isFullScreen,this)},print:function(){const e=u.createElement("IFRAME");e.style.display="none",f.body.appendChild(e);const t=d.printTemplate?d.printTemplate.replace(/\{\{\s*contents\s*\}\}/i,this.getContents(!0)):this.getContents(!0),n=u.getIframeDocument(e),i=this._wd;if(d.iframe){const e=null!==d._printClass?'class="'+d._printClass+'"':d.fullPage?u.getAttributesToString(i.body,["contenteditable"]):'class="'+d._editableClass+'"';n.write("<!DOCTYPE html><html><head>"+i.head.innerHTML+"</head><body "+e+">"+t+"</body></html>")}else{const e=f.head.getElementsByTagName("link"),i=f.head.getElementsByTagName("style");let o="";for(let t=0,n=e.length;t<n;t++)o+=e[t].outerHTML;for(let t=0,n=i.length;t<n;t++)o+=i[t].outerHTML;n.write("<!DOCTYPE html><html><head>"+o+'</head><body class="'+(null!==d._printClass?d._printClass:d._editableClass)+'">'+t+"</body></html>")}this.showLoading(),h.setTimeout((function(){try{if(e.focus(),u.isIE_Edge||f.documentMode||h.StyleMedia)try{e.contentWindow.document.execCommand("print",!1,null)}catch(t){e.contentWindow.print()}else e.contentWindow.print()}catch(n){throw Error("[SUNEDITOR.core.print.fail] error: "+n)}finally{m.closeLoading(),u.removeItem(e)}}),1e3)},preview:function(){m.submenuOff(),m.containerOff(),m.controllersOff();const e=d.previewTemplate?d.previewTemplate.replace(/\{\{\s*contents\s*\}\}/i,this.getContents(!0)):this.getContents(!0),t=h.open("","_blank");t.mimeType="text/html";const n=this._wd;if(d.iframe){const i=null!==d._printClass?'class="'+d._printClass+'"':d.fullPage?u.getAttributesToString(n.body,["contenteditable"]):'class="'+d._editableClass+'"';t.document.write("<!DOCTYPE html><html><head>"+n.head.innerHTML+"<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style></head><body "+i+">"+e+"</body></html>")}else{const n=f.head.getElementsByTagName("link"),i=f.head.getElementsByTagName("style");let o="";for(let e=0,t=n.length;e<t;e++)o+=n[e].outerHTML;for(let e=0,t=i.length;e<t;e++)o+=i[e].outerHTML;t.document.write('<!DOCTYPE html><html><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+a.toolbar.preview+"</title>"+o+'</head><body class="'+(null!==d._printClass?d._printClass:d._editableClass)+'" style="margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;">'+e+"</body></html>")}},setDir:function(t){const n="rtl"===t,i=this._prevRtl!==n;this._prevRtl=d.rtl=n,i&&(this.plugins.align&&this.plugins.align.exchangeDir.call(this),e.tool.indent&&u.changeElement(e.tool.indent.firstElementChild,g.indent),e.tool.outdent&&u.changeElement(e.tool.outdent.firstElementChild,g.outdent));const o=e.element;n?(u.addClass(o.topArea,"se-rtl"),u.addClass(o.wysiwygFrame,"se-rtl")):(u.removeClass(o.topArea,"se-rtl"),u.removeClass(o.wysiwygFrame,"se-rtl"));const s=u.getListChildren(o.wysiwyg,(function(e){return u.isFormatElement(e)&&(e.style.marginRight||e.style.marginLeft||e.style.textAlign)}));for(let e,r,a,d=0,c=s.length;d<c;d++)e=s[d],a=e.style.marginRight,r=e.style.marginLeft,(a||r)&&(e.style.marginRight=r,e.style.marginLeft=a),a=e.style.textAlign,"left"===a?e.style.textAlign="right":"right"===a&&(e.style.textAlign="left");const l=e.tool;l.dir&&(u.changeTxt(l.dir.querySelector(".se-tooltip-text"),a.toolbar[d.rtl?"dir_ltr":"dir_rtl"]),u.changeElement(l.dir.firstElementChild,g[d.rtl?"dir_ltr":"dir_rtl"])),l.dir_ltr&&(n?u.removeClass(l.dir_ltr,"active"):u.addClass(l.dir_ltr,"active")),l.dir_rtl&&(n?u.addClass(l.dir_rtl,"active"):u.removeClass(l.dir_rtl,"active"))},setContents:function(t){this.removeRange();const n=null===t||void 0===t?"":this.convertContentsForEditor(t);if(this._resetComponents(),this._variable.isCodeView){const e=this.convertHTMLForCodeView(n,!1);this._setCodeView(e)}else e.element.wysiwyg.innerHTML=n,this.history.push(!1)},setIframeContents:function(e){if(!d.iframe)return!1;e.head&&(this._wd.head.innerHTML=e.head.replace(/<script[\s\S]*>[\s\S]*<\/script>/gi,"")),e.body&&(this._wd.body.innerHTML=this.convertContentsForEditor(e.body))},getContents:function(t){const n=this.convertHTMLForCodeView(e.element.wysiwyg,!0),i=u.createElement("DIV");i.innerHTML=n;const o=u.getListChildren(i,(function(e){return/FIGCAPTION/i.test(e.nodeName)}));for(let e=0,s=o.length;e<s;e++)o[e].removeAttribute("contenteditable");if(d.fullPage&&!t){const e=u.getAttributesToString(this._wd.body,["contenteditable"]);return"<!DOCTYPE html><html>"+this._wd.head.outerHTML+"<body "+e+">"+i.innerHTML+"</body></html>"}return i.innerHTML},_makeLine:function(e,t){const n=d.defaultTag;if(1===e.nodeType)return u._disallowedTags(e)?"":!t||u.isFormatElement(e)||u.isRangeFormatElement(e)||u.isComponent(e)||u.isMedia(e)||u.isAnchor(e)&&u.isMedia(e.firstElementChild)?e.outerHTML:"<"+n+">"+e.outerHTML+"</"+n+">";if(3===e.nodeType){if(!t)return u._HTMLConvertor(e.textContent);const i=e.textContent.split(/\n/g);let o="";for(let e,t=0,s=i.length;t<s;t++)e=i[t].trim(),e.length>0&&(o+="<"+n+">"+u._HTMLConvertor(e)+"</"+n+">");return o}return 8===e.nodeType&&this._allowHTMLComments?"\x3c!--"+e.textContent.trim()+"--\x3e":""},_tagConvertor:function(e){if(!this._disallowedTextTagsRegExp)return e;const t=d._textTagsMap;return e.replace(this._disallowedTextTagsRegExp,(function(e,n,i,o){return n+("string"===typeof t[i]?t[i]:i)+(o?" "+o:"")}))},_deleteDisallowedTags:function(e){return e.replace(/\n/g,"").replace(/<(script|style)[\s\S]*>[\s\S]*<\/(script|style)>/gi,"").replace(/<[a-z0-9]+\:[a-z0-9]+[^>^\/]*>[^>]*<\/[a-z0-9]+\:[a-z0-9]+>/gi,"").replace(this.editorTagsWhitelistRegExp,"").replace(this.editorTagsBlacklistRegExp,"")},_cleanTags:function(e,t,n){if(/^<[a-z0-9]+\:[a-z0-9]+/i.test(t))return t;let i=null;const o=n.match(/(?!<)[a-zA-Z0-9\-]+/)[0].toLowerCase(),s=this._attributesTagsBlacklist[o];t=s?t.replace(s,""):t.replace(this._attributesBlacklistRegExp,"");const l=this._attributesTagsWhitelist[o];if(i=l?t.match(l):t.match(this._attributesWhitelistRegExp),!e||/<a\b/i.test(n)){const e=t.match(/(?:(?:id|name)\s*=\s*(?:"|')[^"']*(?:"|'))/g);e&&(i||(i=[]),i.push(e[0]))}if((!e||/<span/i.test(n))&&(!i||!/style=/i.test(i.toString()))){const e=t.match(/style\s*=\s*(?:"|')[^"']*(?:"|')/);e&&(i||(i=[]),i.push(e[0]))}if(/<img/i.test(n)){let e="",n="";const o=t.match(/style\s*=\s*(?:"|')[^"']*(?:"|')/);if(i||(i=[]),o&&(e=o[0].match(/width:(.+);/),e=u.getNumber(e?e[1]:"",-1)||"",n=o[0].match(/height:(.+);/),n=u.getNumber(n?n[1]:"",-1)||""),!e||!n){const i=t.match(/width\s*=\s*((?:"|')[^"']*(?:"|'))/),o=t.match(/height\s*=\s*((?:"|')[^"']*(?:"|'))/);(i||o)&&(e=e||(u.getNumber(i?i[1]:"")||""),n=n||(u.getNumber(o?o[1]:"")||""))}i.push('data-origin="'+e+","+n+'"')}if(i)for(let r=0,a=i.length;r<a;r++)e&&/^class="(?!(__se__|se-|katex))/.test(i[r])||(n+=" "+(/^(?:href|src)\s*=\s*('|"|\s)*javascript\s*\:/i.test(i[r])?"":i[r]));return n},cleanHTML:function(e,t,n){e=this._deleteDisallowedTags(this._parser.parseFromString(e,"text/html").body.innerHTML).replace(/(<[a-zA-Z0-9\-]+)[^>]*(?=>)/g,this._cleanTags.bind(this,!0));const i=f.createRange().createContextualFragment(e);try{u._consistencyCheckOfHTML(i,this._htmlCheckWhitelistRegExp,this._htmlCheckBlacklistRegExp,!0)}catch(r){console.warn("[SUNEDITOR.cleanHTML.consistencyCheck.fail] "+r)}if(this.managedTagsInfo&&this.managedTagsInfo.query){const e=i.querySelectorAll(this.managedTagsInfo.query);for(let t,n,i=0,o=e.length;i<o;i++){n=[].slice.call(e[i].classList);for(let o=0,s=n.length;o<s;o++)if(t=this.managedTagsInfo.map[n[o]],t){t(e[i]);break}}}const o=i.childNodes;let s="",l=!1;for(let a,d=0,c=o.length;d<c;d++)if(a=o[d],1===a.nodeType&&!u.isTextStyleElement(a)&&!u.isBreak(a)&&!u._disallowedTags(a)){l=!0;break}for(let a=0,d=o.length;a<d;a++)s+=this._makeLine(o[a],l);return s=u.htmlRemoveWhiteSpace(s),s?(t&&(s=s.replace("string"===typeof t?u.createTagsWhitelist(t):t,"")),n&&(s=s.replace("string"===typeof n?u.createTagsBlacklist(n):n,""))):s=e,this._tagConvertor(s)},convertContentsForEditor:function(e){e=this._deleteDisallowedTags(this._parser.parseFromString(e,"text/html").body.innerHTML).replace(/(<[a-zA-Z0-9\-]+)[^>]*(?=>)/g,this._cleanTags.bind(this,!1));const t=f.createRange().createContextualFragment(e);try{u._consistencyCheckOfHTML(t,this._htmlCheckWhitelistRegExp,this._htmlCheckBlacklistRegExp,!1)}catch(o){console.warn("[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] "+o)}if(this.managedTagsInfo&&this.managedTagsInfo.query){const e=t.querySelectorAll(this.managedTagsInfo.query);for(let t,n,i=0,o=e.length;i<o;i++){n=[].slice.call(e[i].classList);for(let o=0,s=n.length;o<s;o++)if(t=this.managedTagsInfo.map[n[o]],t){t(e[i]);break}}}const n=t.childNodes;let i="";for(let s,l,r=0;r<n.length;r++){if(s=n[r],!u.isFormatElement(s)&&!u.isComponent(s)&&!u.isMedia(s)){if(l||(l=u.createElement(d.defaultTag)),l.appendChild(s),r--,n[r+1]&&!u.isFormatElement(n[r+1]))continue;s=l,l=null}i+=this._makeLine(s,!0)}return 0===i.length?"<"+d.defaultTag+"><br></"+d.defaultTag+">":(i=u.htmlRemoveWhiteSpace(i),this._tagConvertor(i))},convertHTMLForCodeView:function(e,t){let n="";const i=h.RegExp,o=new i("^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$","i"),s="string"===typeof e?f.createRange().createContextualFragment(e):e,l=function(e){return this.isFormatElement(e)||this.isComponent(e)}.bind(u),r=t?"":"\n";let a=t?0:1*this._variable.codeIndent;return a=a>0?new h.Array(a+1).join(" "):"",function e(t,s){const d=t.childNodes,c=o.test(t.nodeName),f=c?s:"";for(let g,m,p,y,C,_,b=0,v=d.length;b<v;b++)g=d[b],y=o.test(g.nodeName),m=y?r:"",p=!l(g)||c||/^(TH|TD)$/i.test(t.nodeName)?"":r,8!==g.nodeType?3!==g.nodeType?0!==g.childNodes.length?g.outerHTML?(C=g.nodeName.toLowerCase(),_=f||y?s:"",n+=(p||(c?"":m))+_+g.outerHTML.match(i("<"+C+"[^>]*>","i"))[0]+m,e(g,s+a),n+=(/\n$/.test(n)?_:"")+"</"+C+">"+(p||m||c||/^(TH|TD)$/i.test(g.nodeName)?r:"")):n+=(new h.XMLSerializer).serializeToString(g):n+=(/^HR$/i.test(g.nodeName)?r:"")+(/^PRE$/i.test(g.parentElement.nodeName)&&/^BR$/i.test(g.nodeName)?"":f)+g.outerHTML+m:u.isList(g.parentElement)||(n+=u._HTMLConvertor(/^\n+$/.test(g.data)?"":g.data)):n+="\n\x3c!-- "+g.textContent.trim()+" --\x3e"+m}(s,""),n.trim()+r},addDocEvent:function(e,t,n){f.addEventListener(e,t,n),d.iframe&&this._wd.addEventListener(e,t)},removeDocEvent:function(e,t){f.removeEventListener(e,t),d.iframe&&this._wd.removeEventListener(e,t)},_charCount:function(e){const t=d.maxCharCount,n=d.charCounterType;let i=0;if(e&&(i=this.getCharLength(e,n)),this._setCharCount(),t>0){let e=!1;const o=y.getCharCount(n);if(o>t){if(e=!0,i>0){this._editorRange();const e=this.getRange(),n=e.endOffset-1,i=this.getSelectionNode().textContent,s=e.endOffset-(o-t);this.getSelectionNode().textContent=i.slice(0,s<0?0:s)+i.slice(e.endOffset,i.length),this.setRange(e.endContainer,n,e.endContainer,n)}}else o+i>t&&(e=!0);if(e&&(this._callCounterBlink(),i>0))return!1}return!0},checkCharCount:function(e,t){if(d.maxCharCount){const n=t||d.charCounterType,i=this.getCharLength("string"===typeof e?e:this._charTypeHTML&&1===e.nodeType?e.outerHTML:e.textContent,n);if(i>0&&i+y.getCharCount(n)>d.maxCharCount)return this._callCounterBlink(),!1}return!0},getCharLength:function(e,t){return/byte/.test(t)?u.getByteLength(e):e.length},_setCharCount:function(){e.element.charCounter&&h.setTimeout((function(){e.element.charCounter.textContent=y.getCharCount(d.charCounterType)}))},_callCounterBlink:function(){const t=e.element.charWrapper;t&&!u.hasClass(t,"se-blink")&&(u.addClass(t,"se-blink"),h.setTimeout((function(){u.removeClass(t,"se-blink")}),600))},_checkComponents:function(){for(let e=0,t=this._fileInfoPluginsCheck.length;e<t;e++)this._fileInfoPluginsCheck[e]()},_resetComponents:function(){for(let e=0,t=this._fileInfoPluginsReset.length;e<t;e++)this._fileInfoPluginsReset[e]()},_setCodeView:function(t){d.codeMirrorEditor?d.codeMirrorEditor.getDoc().setValue(t):e.element.code.value=t},_getCodeView:function(){return d.codeMirrorEditor?d.codeMirrorEditor.getDoc().getValue():e.element.code.value},_setKeyEffect:function(e){const t=this.commandMap,i=this.activePlugins;for(let o in t)e.indexOf(o)>-1||!u.hasOwn(t,o)||(i.indexOf(o)>-1?n[o].active.call(this,null):t.OUTDENT&&/^OUTDENT$/i.test(o)?u.isImportantDisabled(t.OUTDENT)||t.OUTDENT.setAttribute("disabled",!0):t.INDENT&&/^INDENT$/i.test(o)?u.isImportantDisabled(t.INDENT)||t.INDENT.removeAttribute("disabled"):u.removeClass(t[o],"active"))},_init:function(i,o){const l=h.RegExp;if(this._ww=d.iframe?e.element.wysiwygFrame.contentWindow:h,this._wd=f,this._charTypeHTML="byte-html"===d.charCounterType,this.wwComputedStyle=h.getComputedStyle(e.element.wysiwyg),!d.iframe&&"function"===typeof h.ShadowRoot){let t=e.element.wysiwygFrame;for(;t;){if(t.shadowRoot){this._shadowRoot=t.shadowRoot;break}if(t instanceof h.ShadowRoot){this._shadowRoot=t;break}t=t.parentNode}this._shadowRoot&&(this._shadowRootControllerEventTarget=[])}const a=h.Object.keys(d._textTagsMap),c=d.addTagsWhitelist?d.addTagsWhitelist.split("|").filter((function(e){return/b|i|ins|s|strike/i.test(e)})):[];for(let e=0;e<c.length;e++)a.splice(a.indexOf(c[e].toLowerCase()),1);this._disallowedTextTagsRegExp=0===a.length?null:new l("(<\\/?)("+a.join("|")+")\\b\\s*([^>^<]+)?\\s*(?=>)","gi");const g=function(e,t){return e?"*"===e?"[a-z-]+":t?e+"|"+t:e:"^"},m="contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size|data-exp|data-font-size";this._allowHTMLComments=d._editorTagsWhitelist.indexOf("//")>-1||"*"===d._editorTagsWhitelist,this._htmlCheckWhitelistRegExp=new l("^("+g(d._editorTagsWhitelist.replace("|//",""),"")+")$","i"),this._htmlCheckBlacklistRegExp=new l("^("+(d.tagsBlacklist||"^")+")$","i"),this.editorTagsWhitelistRegExp=u.createTagsWhitelist(g(d._editorTagsWhitelist.replace("|//","|\x3c!--|--\x3e"),"")),this.editorTagsBlacklistRegExp=u.createTagsBlacklist(d.tagsBlacklist.replace("|//","|\x3c!--|--\x3e")),this.pasteTagsWhitelistRegExp=u.createTagsWhitelist(g(d.pasteTagsWhitelist,"")),this.pasteTagsBlacklistRegExp=u.createTagsBlacklist(d.pasteTagsBlacklist);const p='\\s*=\\s*(")[^"]*\\1',y=d.attributesWhitelist;let C={},_="";if(y)for(let e in y)u.hasOwn(y,e)&&!/^on[a-z]+$/i.test(y[e])&&("all"===e?_=g(y[e],m):C[e]=new l("\\s(?:"+g(y[e],"")+")"+p,"ig"));this._attributesWhitelistRegExp=new l("\\s(?:"+(_||m)+")"+p,"ig"),this._attributesTagsWhitelist=C;const b=d.attributesBlacklist;if(C={},_="",b)for(let e in b)u.hasOwn(b,e)&&("all"===e?_=g(b[e],""):C[e]=new l("\\s(?:"+g(b[e],"")+")"+p,"ig"));this._attributesBlacklistRegExp=new l("\\s(?:"+(_||"^")+")"+p,"ig"),this._attributesTagsBlacklist=C,this._isInline=/inline/i.test(d.mode),this._isBalloon=/balloon|balloon-always/i.test(d.mode),this._isBalloonAlways=/balloon-always/i.test(d.mode),this._cachingButtons(),this._fileInfoPluginsCheck=[],this._fileInfoPluginsReset=[],this.managedTagsInfo={query:"",map:{}};const v=[];this.activePlugins=[],this._fileManager.tags=[],this._fileManager.pluginMap={};let E,T,w=[];for(let e in n)if(u.hasOwn(n,e)){if(E=n[e],T=t[e],E.active&&T&&this.callPlugin(e,null,T),"function"===typeof E.checkFileInfo&&"function"===typeof E.resetFileInfo&&(this.callPlugin(e,null,T),this._fileInfoPluginsCheck.push(E.checkFileInfo.bind(this)),this._fileInfoPluginsReset.push(E.resetFileInfo.bind(this))),h.Array.isArray(E.fileTags)){const t=E.fileTags;this.callPlugin(e,null,T),this._fileManager.tags=this._fileManager.tags.concat(t),w.push(e);for(let n=0,i=t.length;n<i;n++)this._fileManager.pluginMap[t[n].toLowerCase()]=e}if(E.managedTags){const e=E.managedTags();v.push("."+e.className),this.managedTagsInfo.map[e.className]=e.method.bind(this)}}this.managedTagsInfo.query=v.toString(),this._fileManager.queryString=this._fileManager.tags.join(","),this._fileManager.regExp=new l("^("+this._fileManager.tags.join("|")+")$","i"),this._fileManager.pluginRegExp=new l("^("+(0===w.length?"undefined":w.join("|"))+")$","i"),this._variable._originCssText=e.element.topArea.style.cssText,this._placeholder=e.element.placeholder,this._lineBreaker=e.element.lineBreaker,this._lineBreakerButton=this._lineBreaker.querySelector("button"),this.history=(0,s.Z)(this,this._onChange_historyStack.bind(this)),this.addModule([r.Z]),d.iframe&&(this._wd=e.element.wysiwygFrame.contentDocument,e.element.wysiwyg=this._wd.body,d._editorStyles.editor&&(e.element.wysiwyg.style.cssText=d._editorStyles.editor),"auto"===d.height&&(this._iframeAuto=this._wd.body)),this._initWysiwygArea(i,o),this.setDir(d.rtl?"rtl":"ltr")},_cachingButtons:function(){this.codeViewDisabledButtons=e.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~="se-code-view-enabled"]):not([data-display="MORE"])'),this.resizingDisabledButtons=e.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~="se-resizing-enabled"]):not([data-display="MORE"])'),this.saveButtonStates();const t=e.tool;this.commandMap={SUB:t.subscript,SUP:t.superscript,OUTDENT:t.outdent,INDENT:t.indent},this.commandMap[d.textTags.bold.toUpperCase()]=t.bold,this.commandMap[d.textTags.underline.toUpperCase()]=t.underline,this.commandMap[d.textTags.italic.toUpperCase()]=t.italic,this.commandMap[d.textTags.strike.toUpperCase()]=t.strike,this._styleCommandMap={fullScreen:t.fullScreen,showBlocks:t.showBlocks,codeView:t.codeView}},_initWysiwygArea:function(t,n){e.element.wysiwyg.innerHTML=t?n:this.convertContentsForEditor("string"===typeof n?n:e.element.originElement.value)},_resourcesStateChange:function(){this._iframeAutoHeight(),this._checkPlaceholder()},_onChange_historyStack:function(){this.hasFocus&&p._applyTagEffects(),this._variable.isChanged=!0,e.tool.save&&e.tool.save.removeAttribute("disabled"),y.onChange&&y.onChange(this.getContents(!0),this),"block"===e.element.toolbar.style.display&&p._showToolbarBalloon()},_iframeAutoHeight:function(){this._iframeAuto&&h.setTimeout((function(){e.element.wysiwygFrame.style.height=m._iframeAuto.offsetHeight+"px"}))},_checkPlaceholder:function(){if(this._placeholder){if(this._variable.isCodeView)return void(this._placeholder.style.display="none");const t=e.element.wysiwyg;!u.onlyZeroWidthSpace(t.textContent)||t.querySelector(u._allowedEmptyNodeList)||(t.innerText.match(/\n/g)||"").length>1?this._placeholder.style.display="none":this._placeholder.style.display="block"}},_setDefaultFormat:function(e){if(this._fileManager.pluginRegExp.test(this.currentControllerName))return;const t=this.getRange(),n=t.commonAncestorContainer,i=t.startContainer,o=u.getRangeFormatElement(n,null);let s,l,r;const a=u.getParentElement(n,u.isComponent);if(!a||u.isTable(a)){if(1===n.nodeType&&"true"===n.getAttribute("data-se-embed")){let e=n.nextElementSibling;return u.isFormatElement(e)||(e=this.appendFormatTag(n,d.defaultTag)),void this.setRange(e.firstChild,0,e.firstChild,0)}if(!u.isRangeFormatElement(i)&&!u.isWysiwygDiv(i)||!u.isComponent(i.children[t.startOffset])&&!u.isComponent(i.children[t.startOffset-1])){if(u.getParentElement(n,u.isNotCheckingNode))return null;if(o)return r=u.createElement(e||d.defaultTag),r.innerHTML=o.innerHTML,0===r.childNodes.length&&(r.innerHTML=u.zeroWidthSpace),o.innerHTML=r.outerHTML,r=o.firstChild,s=u.getEdgeChildNodes(r,null).sc,s||(s=u.createTextNode(u.zeroWidthSpace),r.insertBefore(s,r.firstChild)),l=s.textContent.length,void this.setRange(s,l,s,l);if(u.isRangeFormatElement(n)&&n.childNodes.length<=1){let e=null;return 1===n.childNodes.length&&u.isBreak(n.firstChild)?e=n.firstChild:(e=u.createTextNode(u.zeroWidthSpace),n.appendChild(e)),void this.setRange(e,1,e,1)}if(this.execCommand("formatBlock",!1,e||d.defaultTag),s=u.getEdgeChildNodes(n,n),s=s?s.ec:n,r=u.getFormatElement(s,null),!r)return this.removeRange(),void this._editorRange();if(u.isBreak(r.nextSibling)&&u.removeItem(r.nextSibling),u.isBreak(r.previousSibling)&&u.removeItem(r.previousSibling),u.isBreak(s)){const e=u.createTextNode(u.zeroWidthSpace);s.parentNode.insertBefore(e,s),s=e}this.effectNode=null,this.nativeFocus()}}},_setOptionsInit:function(t,n){this.context=e=(0,o.Z)(t.originElement,this._getConstructed(t),d),this._componentsInfoReset=!0,this._editorInit(!0,n)},_editorInit:function(t,n){this._init(t,n),p._addEvent(),this._setCharCount(),p._offStickyToolbar(),p.onResize_window(),e.element.toolbar.style.visibility="",this._checkComponents(),this._componentsInfoInit=!1,this._componentsInfoReset=!1,this.history.reset(!0),this._resourcesStateChange(),h.setTimeout((function(){"function"===typeof y.onload&&y.onload(m,t)}))},_getConstructed:function(e){return{_top:e.topArea,_relative:e.relative,_toolBar:e.toolbar,_menuTray:e._menuTray,_editorArea:e.editorArea,_wysiwygArea:e.wysiwygFrame,_codeArea:e.code,_placeholder:e.placeholder,_resizingBar:e.resizingBar,_navigation:e.navigation,_charCounter:e.charCounter,_charWrapper:e.charWrapper,_loading:e.loading,_lineBreaker:e.lineBreaker,_lineBreaker_t:e.lineBreaker_t,_lineBreaker_b:e.lineBreaker_b,_resizeBack:e.resizeBackground,_stickyDummy:e._stickyDummy,_arrow:e._arrow}}},p={_IEisComposing:!1,_lineBreakerBind:null,_responsiveCurrentSize:"default",_responsiveButtonSize:null,_responsiveButtons:null,_directionKeyCode:new h.RegExp("^(8|13|3[2-9]|40|46)$"),_nonTextKeyCode:new h.RegExp("^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$"),_historyIgnoreKeyCode:new h.RegExp("^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$"),_onButtonsCheck:new h.RegExp("^("+h.Object.keys(d._textTagsMap).join("|")+")$","i"),_frontZeroWidthReg:new h.RegExp(u.zeroWidthSpace+"+",""),_keyCodeShortcut:{65:"A",66:"B",83:"S",85:"U",73:"I",89:"Y",90:"Z",219:"[",221:"]"},_shortcutCommand:function(e,t){let n=null;switch(p._keyCodeShortcut[e]){case"A":n="selectAll";break;case"B":-1===d.shortcutsDisable.indexOf("bold")&&(n="bold");break;case"S":t&&-1===d.shortcutsDisable.indexOf("strike")?n="strike":t||-1!==d.shortcutsDisable.indexOf("save")||(n="save");break;case"U":-1===d.shortcutsDisable.indexOf("underline")&&(n="underline");break;case"I":-1===d.shortcutsDisable.indexOf("italic")&&(n="italic");break;case"Z":-1===d.shortcutsDisable.indexOf("undo")&&(n=t?"redo":"undo");break;case"Y":-1===d.shortcutsDisable.indexOf("undo")&&(n="redo");break;case"[":-1===d.shortcutsDisable.indexOf("indent")&&(n=d.rtl?"indent":"outdent");break;case"]":-1===d.shortcutsDisable.indexOf("indent")&&(n=d.rtl?"outdent":"indent")}return!!n&&(m.commandHandler(m.commandMap[n],n),!0)},_applyTagEffects:function(){let t=m.getSelectionNode();if(t===m.effectNode)return;m.effectNode=t;const i=d.rtl?"marginRight":"marginLeft",o=m.commandMap,s=this._onButtonsCheck,l=[],r=[],a=m.activePlugins,c=a.length;let f="";for(;t.firstChild;)t=t.firstChild;for(let e=t;!u.isWysiwygDiv(e)&&e;e=e.parentNode)if(1===e.nodeType&&!u.isBreak(e)){if(f=e.nodeName.toUpperCase(),r.push(f),!m.isReadOnly)for(let t,i=0;i<c;i++)t=a[i],-1===l.indexOf(t)&&n[t].active.call(m,e)&&l.push(t);u.isFormatElement(e)?(-1===l.indexOf("OUTDENT")&&o.OUTDENT&&!u.isImportantDisabled(o.OUTDENT)&&(u.isListCell(e)||e.style[i]&&u.getNumber(e.style[i],0)>0)&&(l.push("OUTDENT"),o.OUTDENT.removeAttribute("disabled")),-1===l.indexOf("INDENT")&&o.INDENT&&!u.isImportantDisabled(o.INDENT)&&(l.push("INDENT"),u.isListCell(e)&&!e.previousElementSibling?o.INDENT.setAttribute("disabled",!0):o.INDENT.removeAttribute("disabled"))):s.test(f)&&(l.push(f),u.addClass(o[f],"active"))}m._setKeyEffect(l),m._variable.currentNodes=r.reverse(),m._variable.currentNodesMap=l,d.showPathLabel&&(e.element.navigation.textContent=m._variable.currentNodes.join(" > "))},_cancelCaptionEdit:function(){this.setAttribute("contenteditable",!1),this.removeEventListener("blur",p._cancelCaptionEdit)},_buttonsEventHandler:function(e){let t=e.target;if(m._bindControllersOff&&e.stopPropagation(),/^(input|textarea|select|option)$/i.test(t.nodeName)?m._antiBlur=!1:e.preventDefault(),u.getParentElement(t,".se-submenu"))e.stopPropagation(),m._notHideToolbar=!0;else{let n=t.getAttribute("data-command"),i=t.className;for(;!n&&!/se-menu-list/.test(i)&&!/sun-editor-common/.test(i);)t=t.parentNode,n=t.getAttribute("data-command"),i=t.className;n!==m._submenuName&&n!==m._containerName||e.stopPropagation()}},onClick_toolbar:function(e){let t=e.target,n=t.getAttribute("data-display"),i=t.getAttribute("data-command"),o=t.className;for(m.controllersOff();t.parentNode&&!i&&!/se-menu-list/.test(o)&&!/se-toolbar/.test(o);)t=t.parentNode,i=t.getAttribute("data-command"),n=t.getAttribute("data-display"),o=t.className;(i||n)&&(t.disabled||(m.isReadOnly||m.hasFocus||m.nativeFocus(),m.isReadOnly||m._variable.isCodeView||m._editorRange(),m.actionCall(i,n,t)))},onMouseDown_wysiwyg:function(t){if(m.isReadOnly||u.isNonEditable(e.element.wysiwyg))return;if(m._editorRange(),"function"===typeof y.onMouseDown&&!1===y.onMouseDown(t,m))return;const n=u.getParentElement(t.target,u.isCell);if(n){const e=m.plugins.table;e&&n!==e._fixedCell&&!e._shift&&m.callPlugin("table",(function(){e.onTableCellMultiSelect.call(m,n,!1)}),null)}m._isBalloon&&p._hideToolbar(),/FIGURE/i.test(t.target.nodeName)&&t.preventDefault()},onClick_wysiwyg:function(t){const n=t.target;if(m.isReadOnly)return t.preventDefault(),u.isAnchor(n)&&h.open(n.href,n.target),!1;if(u.isNonEditable(e.element.wysiwyg))return;if("function"===typeof y.onClick&&!1===y.onClick(t,m))return;const i=m.getFileComponent(n);if(i)return t.preventDefault(),void m.selectComponent(i.target,i.pluginName);const o=u.getParentElement(n,"FIGCAPTION");if(u.isNonEditable(o)&&(t.preventDefault(),o.setAttribute("contenteditable",!0),o.focus(),m._isInline&&!m._inlineToolbarAttr.isShow)){p._showToolbarInline();const e=function(){p._hideToolbar(),o.removeEventListener("blur",e)};o.addEventListener("blur",e)}h.setTimeout(m._editorRange.bind(m)),m._editorRange();const s=m.getSelectionNode(),l=u.getFormatElement(s,null),r=u.getRangeFormatElement(s,null);if(l||u.isNonEditable(n)||u.isList(r))p._applyTagEffects();else{const e=m.getRange();if(u.getFormatElement(e.startContainer)===u.getFormatElement(e.endContainer))if(u.isList(r)){t.preventDefault();const e=u.createElement("LI"),n=s.nextElementSibling;e.appendChild(s),r.insertBefore(e,n),m.focus()}else u.isWysiwygDiv(s)||u.isComponent(s)||u.isTable(s)&&!u.isCell(s)||null===m._setDefaultFormat(u.isRangeFormatElement(r)?"DIV":d.defaultTag)?p._applyTagEffects():(t.preventDefault(),m.focus())}m._isBalloon&&h.setTimeout(p._toggleToolbarBalloon)},_balloonDelay:null,_showToolbarBalloonDelay:function(){p._balloonDelay&&h.clearTimeout(p._balloonDelay),p._balloonDelay=h.setTimeout(function(){h.clearTimeout(this._balloonDelay),this._balloonDelay=null,this._showToolbarBalloon()}.bind(p),350)},_toggleToolbarBalloon:function(){m._editorRange();const e=m.getRange();m._bindControllersOff||!m._isBalloonAlways&&e.collapsed?p._hideToolbar():p._showToolbarBalloon(e)},_showToolbarBalloon:function(t){if(!m._isBalloon)return;const n=t||m.getRange(),i=e.element.toolbar,o=e.element.topArea,s=m.getSelection();let l;if(m._isBalloonAlways&&n.collapsed)l=!0;else if(s.focusNode===s.anchorNode)l=s.focusOffset<s.anchorOffset;else{const e=u.getListChildNodes(n.commonAncestorContainer,null);l=u.getArrayIndex(e,s.focusNode)<u.getArrayIndex(e,s.anchorNode)}let r=n.getClientRects();r=r[l?0:r.length-1];const a=m.getGlobalScrollOffset();let c=a.left,f=a.top;const g=o.offsetWidth,y=p._getEditorOffsets(null),C=y.top,_=y.left;if(i.style.top="-10000px",i.style.visibility="hidden",i.style.display="block",!r){const t=m.getSelectionNode();if(u.isFormatElement(t)){const e=u.createTextNode(u.zeroWidthSpace);m.insertNode(e,null,!1),m.setRange(e,1,e,1),m._editorRange(),r=m.getRange().getClientRects(),r=r[l?0:r.length-1]}if(!r){const n=u.getOffset(t,e.element.wysiwygFrame);r={left:n.left,top:n.top,right:n.left,bottom:n.top+t.offsetHeight,noText:!0},c=0,f=0}l=!0}const b=h.Math.round(e.element._arrow.offsetWidth/2),v=i.offsetWidth,E=i.offsetHeight,T=/iframe/i.test(e.element.wysiwygFrame.nodeName)?e.element.wysiwygFrame.getClientRects()[0]:null;if(T&&(r={left:r.left+T.left,top:r.top+T.top,right:r.right+T.right-T.width,bottom:r.bottom+T.bottom-T.height}),p._setToolbarOffset(l,r,i,_,g,c,f,C,b),v===i.offsetWidth&&E===i.offsetHeight||p._setToolbarOffset(l,r,i,_,g,c,f,C,b),d.toolbarContainer){const e=o.parentElement;let t=d.toolbarContainer,n=t.offsetLeft,s=t.offsetTop;for(;!t.parentElement.contains(e)||!/^(BODY|HTML)$/i.test(t.parentElement.nodeName);)t=t.offsetParent,n+=t.offsetLeft,s+=t.offsetTop;i.style.left=i.offsetLeft-n+o.offsetLeft+"px",i.style.top=i.offsetTop-s+o.offsetTop+"px"}i.style.visibility=""},_setToolbarOffset:function(t,n,i,o,s,l,r,a,d){const c=i.offsetWidth,g=n.noText&&!t?0:i.offsetHeight,m=(t?n.left:n.right)-o-c/2+l,y=m+c-s;let C=(t?n.top-g-d:n.bottom+d)-(n.noText?0:a)+r,_=m<0?1:y<0?m:m-y-1-1,b=!1;const v=C+(t?p._getEditorOffsets(null).top:i.offsetHeight-e.element.wysiwyg.offsetHeight);!t&&v>0&&p._getPageBottomSpace()<v?(t=!0,b=!0):t&&f.documentElement.offsetTop>v&&(t=!1,b=!0),b&&(C=(t?n.top-g-d:n.bottom+d)-(n.noText?0:a)+r),i.style.left=h.Math.floor(_)+"px",i.style.top=h.Math.floor(C)+"px",t?(u.removeClass(e.element._arrow,"se-arrow-up"),u.addClass(e.element._arrow,"se-arrow-down"),e.element._arrow.style.top=g+"px"):(u.removeClass(e.element._arrow,"se-arrow-down"),u.addClass(e.element._arrow,"se-arrow-up"),e.element._arrow.style.top=-d+"px");const E=h.Math.floor(c/2+(m-_));e.element._arrow.style.left=(E+d>i.offsetWidth?i.offsetWidth-d:E<d?d:E)+"px"},_showToolbarInline:function(){if(!m._isInline)return;const t=e.element.toolbar;d.toolbarContainer?t.style.position="relative":t.style.position="absolute",t.style.visibility="hidden",t.style.display="block",m._inlineToolbarAttr.width=t.style.width=d.toolbarWidth,m._inlineToolbarAttr.top=t.style.top=(d.toolbarContainer?0:-1-t.offsetHeight)+"px","function"===typeof y.showInline&&y.showInline(t,e,m),p.onScroll_window(),m._inlineToolbarAttr.isShow=!0,t.style.visibility=""},_hideToolbar:function(){m._notHideToolbar||m._variable.isFullScreen||(e.element.toolbar.style.display="none",m._inlineToolbarAttr.isShow=!1)},onInput_wysiwyg:function(e){if(m.isReadOnly||m.isDisabled)return e.preventDefault(),e.stopPropagation(),m.history.go(m.history.getCurrentIndex()),!1;if(m._editorRange(),"function"===typeof y.onInput&&!1===y.onInput(e,m))return;const t=(null===e.data?"":void 0===e.data?" ":e.data)||"";if(!m._charCount(t))return e.preventDefault(),e.stopPropagation(),!1;m.history.push(!0)},_isUneditableNode:function(e,t){const n=t?e.startContainer:e.endContainer,i=t?e.startOffset:e.endOffset,o=t?"previousSibling":"nextSibling";let s;return 1===n.nodeType?(s=p._isUneditableNode_getSibling(n.childNodes[i],o,n),s&&1===s.nodeType&&"false"===s.getAttribute("contenteditable")):(s=p._isUneditableNode_getSibling(n,o,n),m.isEdgePoint(n,i,t?"front":"end")&&s&&1===s.nodeType&&"false"===s.getAttribute("contenteditable"))},_isUneditableNode_getSibling:function(e,t,n){if(!e)return null;let i=e[t];if(!i){if(i=u.getFormatElement(n),i=i?i[t]:null,!i||u.isComponent(i))return null;i="previousSibling"===t?i.firstElementChild:i.lastElementChild}return i},_onShortcutKey:!1,onKeyDown_wysiwyg:function(t){const n=t.keyCode,i=t.shiftKey,o=t.ctrlKey||t.metaKey||91===n||92===n||224===n,s=t.altKey;if(p._IEisComposing=229===n,!o&&m.isReadOnly&&!p._directionKeyCode.test(n))return t.preventDefault(),!1;if(m.submenuOff(),m._isBalloon&&p._hideToolbar(),"function"===typeof y.onKeyDown&&!1===y.onKeyDown(t,m))return;if(o&&p._shortcutCommand(n,i))return p._onShortcutKey=!0,t.preventDefault(),t.stopPropagation(),!1;p._onShortcutKey&&(p._onShortcutKey=!1);let l=m.getSelectionNode();const r=m.getRange(),a=!r.collapsed||r.startContainer!==r.endContainer,c=m._fileManager.pluginRegExp.test(m.currentControllerName)?m.currentControllerName:"";let f=u.getFormatElement(l,null)||l,g=u.getRangeFormatElement(f,null);switch(n){case 8:if(!a&&c){t.preventDefault(),t.stopPropagation(),m.plugins[c].destroy.call(m);break}if(a&&p._hardDelete()){t.preventDefault(),t.stopPropagation();break}if(!u.isFormatElement(f)&&!e.element.wysiwyg.firstElementChild&&!u.isComponent(l)&&null!==m._setDefaultFormat(d.defaultTag))return t.preventDefault(),t.stopPropagation(),!1;if(!a&&!f.previousElementSibling&&0===r.startOffset&&!l.previousSibling&&!u.isListCell(f)&&u.isFormatElement(f)&&(!u.isFreeFormatElement(f)||u.isClosureFreeFormatElement(f))){if(u.isClosureRangeFormatElement(f.parentNode))return t.preventDefault(),t.stopPropagation(),!1;if(u.isWysiwygDiv(f.parentNode)&&f.childNodes.length<=1&&(!f.firstChild||u.onlyZeroWidthSpace(f.textContent))){if(t.preventDefault(),t.stopPropagation(),f.nodeName.toUpperCase()===d.defaultTag.toUpperCase()){f.innerHTML="<br>";const e=f.attributes;for(;e[0];)f.removeAttribute(e[0].name)}else{const e=u.createElement(d.defaultTag);e.innerHTML="<br>",f.parentElement.replaceChild(e,f)}return m.nativeFocus(),!1}}if(f&&r.startContainer===r.endContainer&&3===l.nodeType&&!u.isFormatElement(l.parentNode)&&(r.collapsed?1===l.textContent.length:r.endOffset-r.startOffset===l.textContent.length)){t.preventDefault();let e=null,n=l.parentNode.previousSibling;const i=l.parentNode.nextSibling;n||(i?(n=i,e=0):(n=u.createElement("BR"),f.appendChild(n))),l.textContent="",u.removeItemAllParents(l,null,f),e="number"===typeof e?e:3===n.nodeType?n.textContent.length:1,m.setRange(n,e,n,e);break}if(p._isUneditableNode(r,!0)){t.preventDefault(),t.stopPropagation();break}const n=r.commonAncestorContainer;if(f=u.getFormatElement(r.startContainer,null),g=u.getRangeFormatElement(f,null),g&&f&&!u.isCell(g)&&!/^FIGCAPTION$/i.test(g.nodeName)){if(u.isListCell(f)&&u.isList(g)&&(u.isListCell(g.parentNode)||f.previousElementSibling)&&(l===f||3===l.nodeType&&(!l.previousSibling||u.isList(l.previousSibling)))&&(u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null)?g.contains(r.startContainer):0===r.startOffset&&r.collapsed)){if(r.startContainer!==r.endContainer)t.preventDefault(),m.removeNode(),3===r.startContainer.nodeType&&m.setRange(r.startContainer,r.startContainer.textContent.length,r.startContainer,r.startContainer.textContent.length),m.history.push(!0);else{let e=f.previousElementSibling||g.parentNode;if(u.isListCell(e)){t.preventDefault();let n=e;if(!e.contains(f)&&u.isListCell(n)&&u.isList(n.lastElementChild)){for(n=n.lastElementChild.lastElementChild;u.isListCell(n)&&u.isList(n.lastElementChild);)n=n.lastElementChild&&n.lastElementChild.lastElementChild;e=n}let i=e===g.parentNode?g.previousSibling:e.lastChild;i||(i=u.createTextNode(u.zeroWidthSpace),g.parentNode.insertBefore(i,g.parentNode.firstChild));const o=3===i.nodeType?i.textContent.length:1,s=f.childNodes;let l=i,r=s[0];for(;r=s[0];)e.insertBefore(r,l.nextSibling),l=r;u.removeItem(f),0===g.children.length&&u.removeItem(g),m.setRange(i,o,i,o),m.history.push(!0)}}break}if(!a&&0===r.startOffset){let e=!0,i=n;for(;i&&i!==g&&!u.isWysiwygDiv(i);){if(i.previousSibling&&(1===i.previousSibling.nodeType||!u.onlyZeroWidthSpace(i.previousSibling.textContent.trim()))){e=!1;break}i=i.parentNode}if(e&&g.parentNode){t.preventDefault(),m.detachRangeFormatElement(g,u.isListCell(f)?[f]:null,null,!1,!1),m.history.push(!0);break}}}if(!a&&f&&(0===r.startOffset||l===f&&f.childNodes[r.startOffset])){const e=l===f?f.childNodes[r.startOffset]:l,i=f.previousSibling,o=(3===n.nodeType||u.isBreak(n))&&!n.previousSibling&&0===r.startOffset;if(!e.previousSibling&&(u.isComponent(n.previousSibling)||o&&u.isComponent(i))){const e=m.getFileComponent(i);e?(t.preventDefault(),t.stopPropagation(),0===f.textContent.length&&u.removeItem(f),!1===m.selectComponent(e.target,e.pluginName)&&m.blur()):u.isComponent(i)&&(t.preventDefault(),t.stopPropagation(),u.removeItem(i));break}if(u.isNonEditable(e.previousSibling)){t.preventDefault(),t.stopPropagation(),u.removeItem(e.previousSibling);break}}break;case 46:if(c){t.preventDefault(),t.stopPropagation(),m.plugins[c].destroy.call(m);break}if(a&&p._hardDelete()){t.preventDefault(),t.stopPropagation();break}if(p._isUneditableNode(r,!1)){t.preventDefault(),t.stopPropagation();break}if((u.isFormatElement(l)||null===l.nextSibling||u.onlyZeroWidthSpace(l.nextSibling)&&null===l.nextSibling.nextSibling)&&r.startOffset===l.textContent.length){const e=f.nextElementSibling;if(!e)break;if(u.isComponent(e)){if(t.preventDefault(),u.onlyZeroWidthSpace(f)&&(u.removeItem(f),u.isTable(e))){let t=u.getChildElement(e,u.isCell,!1);t=t.firstElementChild||t,m.setRange(t,0,t,0);break}const n=m.getFileComponent(e);n?(t.stopPropagation(),!1===m.selectComponent(n.target,n.pluginName)&&m.blur()):u.isComponent(e)&&(t.stopPropagation(),u.removeItem(e));break}}if(!a&&(m.isEdgePoint(r.endContainer,r.endOffset)||l===f&&f.childNodes[r.startOffset])){const e=l===f&&f.childNodes[r.startOffset]||l;if(e&&u.isNonEditable(e.nextSibling)){t.preventDefault(),t.stopPropagation(),u.removeItem(e.nextSibling);break}if(u.isComponent(e)){t.preventDefault(),t.stopPropagation(),u.removeItem(e);break}}if(f=u.getFormatElement(r.startContainer,null),g=u.getRangeFormatElement(f,null),u.isListCell(f)&&u.isList(g)&&(l===f||3===l.nodeType&&(!l.nextSibling||u.isList(l.nextSibling))&&(u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null)?g.contains(r.endContainer):r.endOffset===l.textContent.length&&r.collapsed))){r.startContainer!==r.endContainer&&m.removeNode();let e=u.getArrayItem(f.children,u.isList,!1);if(e=e||f.nextElementSibling||g.parentNode.nextElementSibling,e&&(u.isList(e)||u.getArrayItem(e.children,u.isList,!1))){let n,i;if(t.preventDefault(),u.isList(e)){const t=e.firstElementChild;for(i=t.childNodes,n=i[0];i[0];)f.insertBefore(i[0],e);u.removeItem(t)}else{for(n=e.firstChild,i=e.childNodes;i[0];)f.appendChild(i[0]);u.removeItem(e)}m.setRange(n,0,n,0),m.history.push(!0)}break}break;case 9:if(c||d.tabDisable)break;if(t.preventDefault(),o||s||u.isWysiwygDiv(l))break;const C=!r.collapsed||m.isEdgePoint(r.startContainer,r.startOffset),_=m.getSelectedElements(null);l=m.getSelectionNode();const b=[];let v=[],E=u.isListCell(_[0]),T=u.isListCell(_[_.length-1]),w={sc:r.startContainer,so:r.startOffset,ec:r.endContainer,eo:r.endOffset};for(let e,t=0,o=_.length;t<o;t++)if(e=_[t],u.isListCell(e)){if(!e.previousElementSibling&&!i)continue;b.push(e)}else v.push(e);if(b.length>0&&C&&m.plugins.list)w=m.plugins.list.editInsideList.call(m,i,b);else{const e=u.getParentElement(l,u.isCell);if(e&&C){const t=u.getParentElement(e,"table"),n=u.getListChildren(t,u.isCell);let o=i?u.prevIdx(n,e):u.nextIdx(n,e);o!==n.length||i||(o=0),-1===o&&i&&(o=n.length-1);let s=n[o];if(!s)break;s=s.firstElementChild||s,m.setRange(s,0,s,0);break}v=v.concat(b),E=T=null}if(v.length>0)if(i){const e=v.length-1;for(let i,o=0;o<=e;o++){i=v[o].childNodes;for(let e,t=0,n=i.length;t<n&&(e=i[t],e);t++)if(!u.onlyZeroWidthSpace(e)){/^\s{1,4}$/.test(e.textContent)?u.removeItem(e):/^\s{1,4}/.test(e.textContent)&&(e.textContent=e.textContent.replace(/^\s{1,4}/,""));break}}const t=u.getChildElement(v[0],"text",!1),n=u.getChildElement(v[e],"text",!0);!E&&t&&(w.sc=t,w.so=0),!T&&n&&(w.ec=n,w.eo=n.textContent.length)}else{const e=u.createTextNode(new h.Array(m._variable.tabSize+1).join("\xa0"));if(1===v.length){const t=m.insertNode(e,null,!0);if(!t)return!1;E||(w.sc=e,w.so=t.endOffset),T||(w.ec=e,w.eo=t.endOffset)}else{const t=v.length-1;for(let o,s=0;s<=t;s++)o=v[s].firstChild,o&&(u.isBreak(o)?v[s].insertBefore(e.cloneNode(!1),o):o.textContent=e.textContent+o.textContent);const n=u.getChildElement(v[0],"text",!1),i=u.getChildElement(v[t],"text",!0);!E&&n&&(w.sc=n,w.so=0),!T&&i&&(w.ec=i,w.eo=i.textContent.length)}}m.setRange(w.sc,w.so,w.ec,w.eo),m.history.push(!1);break;case 13:const N=u.getFreeFormatElement(l,null);if(m._charTypeHTML){let e="";if(e=!i&&N||i?"<br>":"<"+f.nodeName+"><br></"+f.nodeName+">",!m.checkCharCount(e,"byte-html"))return t.preventDefault(),!1}if(!i){const e=m._isEdgeFormat(r.endContainer,r.endOffset,"end");if(e&&/^H[1-6]$/i.test(f.nodeName)||/^HR$/i.test(f.nodeName)){t.preventDefault();let n=null;const i=m.appendFormatTag(f,d.defaultTag);if(e&&e.length>0){n=e.pop();const t=n;for(;e.length>0;)n=n.appendChild(e.pop());i.appendChild(t)}n=n?n.appendChild(i.firstChild):i.firstChild,m.setRange(n,0,n,0);break}if(d.lineAttrReset&&f){let e;if(t.preventDefault(),t.stopPropagation(),r.collapsed)e=u.splitElement(r.endContainer,r.endOffset,0);else{const t=u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null),n=m.removeNode();if(t)if(e=u.getFormatElement(n.container,null),n.prevContainer)e!==f&&e.nextElementSibling===f&&(e=f);else{const t=f.cloneNode(!1);t.innerHTML="<br>",e.parentNode.insertBefore(t,e)}else e=u.splitElement(n.container,n.offset,0)}const n="*"===d.lineAttrReset?null:d.lineAttrReset,i=e.attributes;let o=0;for(;i[o];)n&&n.test(i[o].name)?o++:e.removeAttribute(i[o].name);m.setRange(e.firstChild,0,e.firstChild,0);break}if(N){t.preventDefault();const e=l===N,n=m.getSelection(),i=l.childNodes,o=n.focusOffset,s=l.previousElementSibling,a=l.nextSibling;if(!u.isClosureFreeFormatElement(N)&&i&&(e&&r.collapsed&&i.length-1<=o+1&&u.isBreak(i[o])&&(!i[o+1]||(!i[o+2]||u.onlyZeroWidthSpace(i[o+2].textContent))&&3===i[o+1].nodeType&&u.onlyZeroWidthSpace(i[o+1].textContent))&&o>0&&u.isBreak(i[o-1])||!e&&u.onlyZeroWidthSpace(l.textContent)&&u.isBreak(s)&&(u.isBreak(s.previousSibling)||!u.onlyZeroWidthSpace(s.previousSibling.textContent))&&(!a||!u.isBreak(a)&&u.onlyZeroWidthSpace(a.textContent)))){e?u.removeItem(i[o-1]):u.removeItem(l);const t=m.appendFormatTag(N,u.isFormatElement(N.nextElementSibling)&&!u.isRangeFormatElement(N.nextElementSibling)?N.nextElementSibling:null);u.copyFormatAttributes(t,N),m.setRange(t,1,t,1);break}if(e){y.insertHTML(r.collapsed&&u.isBreak(r.startContainer.childNodes[r.startOffset-1])?"<br>":"<br><br>",!0,!1);let e=n.focusNode;const t=n.focusOffset;N===e&&(e=e.childNodes[t-o>1?t-1:t]),m.setRange(e,1,e,1)}else{const e=n.focusNode.nextSibling,t=u.createElement("BR");m.insertNode(t,null,!1);const i=t.previousSibling,o=t.nextSibling;u.isBreak(e)||u.isBreak(i)||o&&!u.onlyZeroWidthSpace(o)?m.setRange(o,0,o,0):(t.parentNode.insertBefore(t.cloneNode(!1),t),m.setRange(t,1,t,1))}p._onShortcutKey=!0;break}}if(a)break;if(g&&f&&!u.isCell(g)&&!/^FIGCAPTION$/i.test(g.nodeName)){const e=m.getRange();if(m.isEdgePoint(e.endContainer,e.endOffset)&&u.isList(l.nextSibling)){t.preventDefault();const e=u.createElement("LI"),n=u.createElement("BR");e.appendChild(n),f.parentNode.insertBefore(e,f.nextElementSibling),e.appendChild(l.nextSibling),m.setRange(n,1,n,1);break}if((3!==e.commonAncestorContainer.nodeType||!e.commonAncestorContainer.nextElementSibling)&&u.onlyZeroWidthSpace(f.innerText.trim())){t.preventDefault();let e=null;if(u.isListCell(g.parentNode)){if(g=f.parentNode.parentNode.parentNode,e=u.splitElement(f,null,u.getElementDepth(f)-2),!e){const t=u.createElement("LI");t.innerHTML="<br>",g.insertBefore(t,e),e=t}}else{const t=u.isCell(g.parentNode)?"DIV":u.isList(g.parentNode)?"LI":u.isFormatElement(g.nextElementSibling)&&!u.isRangeFormatElement(g.nextElementSibling)?g.nextElementSibling.nodeName:u.isFormatElement(g.previousElementSibling)&&!u.isRangeFormatElement(g.previousElementSibling)?g.previousElementSibling.nodeName:d.defaultTag;e=u.createElement(t);const n=m.detachRangeFormatElement(g,[f],null,!0,!0);n.cc.insertBefore(e,n.ec)}e.innerHTML="<br>",u.removeItemAllParents(f,null,null),m.setRange(e,1,e,1);break}}if(g&&u.getParentElement(g,"FIGCAPTION")&&u.getParentElement(g,u.isList)&&(t.preventDefault(),f=m.appendFormatTag(f,null),m.setRange(f,0,f,0)),c){t.preventDefault(),t.stopPropagation();const n=e[c],i=n._container,o=i.previousElementSibling||i.nextElementSibling;let s=null;u.isListCell(i.parentNode)?s=u.createElement("BR"):(s=u.createElement(u.isFormatElement(o)&&!u.isRangeFormatElement(o)?o.nodeName:d.defaultTag),s.innerHTML="<br>"),i.parentNode.insertBefore(s,i),m.callPlugin(c,(function(){!1===m.selectComponent(n._element,c)&&m.blur()}),null)}break;case 27:if(c)return t.preventDefault(),t.stopPropagation(),m.controllersOff(),!1}if(i&&16===n){t.preventDefault(),t.stopPropagation();const e=m.plugins.table;if(e&&!e._shift&&!e._ref){const t=u.getParentElement(f,u.isCell);if(t)return void e.onTableCellMultiSelect.call(m,t,!0)}}else if(i&&(u.isOSX_IOS?s:o)&&32===n){t.preventDefault(),t.stopPropagation();const e=m.insertNode(u.createTextNode("\xa0"));if(e&&e.container)return void m.setRange(e.container,e.endOffset,e.container,e.endOffset)}if(!o&&!s&&!a&&!p._nonTextKeyCode.test(n)&&r.collapsed&&r.startContainer===r.endContainer&&u.isBreak(r.commonAncestorContainer)){const e=u.createTextNode(u.zeroWidthSpace);m.insertNode(e,null,!1),m.setRange(e,1,e,1)}},onKeyUp_wysiwyg:function(e){if(p._onShortcutKey)return;m._editorRange();const t=e.keyCode,n=e.ctrlKey||e.metaKey||91===t||92===t||224===t,i=e.altKey;if(m.isReadOnly)return void(!n&&p._directionKeyCode.test(t)&&p._applyTagEffects());const o=m.getRange();let s=m.getSelectionNode();if(m._isBalloon&&(m._isBalloonAlways&&27!==t||!o.collapsed)){if(!m._isBalloonAlways)return void p._showToolbarBalloon();27!==t&&p._showToolbarBalloonDelay()}if(8===t&&u.isWysiwygDiv(s)&&""===s.textContent&&0===s.children.length){e.preventDefault(),e.stopPropagation(),s.innerHTML="";const t=u.createElement(u.isFormatElement(m._variable.currentNodes[0])?m._variable.currentNodes[0]:d.defaultTag);return t.innerHTML="<br>",s.appendChild(t),m.setRange(t,0,t,0),p._applyTagEffects(),void m.history.push(!1)}const l=u.getFormatElement(s,null),r=u.getRangeFormatElement(s,null);l||!o.collapsed||u.isComponent(s)||u.isList(s)||null===m._setDefaultFormat(u.isRangeFormatElement(r)?"DIV":d.defaultTag)||(s=m.getSelectionNode()),p._directionKeyCode.test(t)&&p._applyTagEffects();if(!n&&!i&&!p._nonTextKeyCode.test(t)&&3===s.nodeType&&u.zeroWidthRegExp.test(s.textContent)&&!(void 0!==e.isComposing?e.isComposing:p._IEisComposing)){let e=o.startOffset,t=o.endOffset;const n=(s.textContent.substring(0,t).match(p._frontZeroWidthReg)||"").length;e=o.startOffset-n,t=o.endOffset-n,s.textContent=s.textContent.replace(u.zeroWidthRegExp,""),m.setRange(s,e<0?0:e,s,t<0?0:t)}m._charCount(""),"function"===typeof y.onKeyUp&&!1===y.onKeyUp(e,m)||n||i||p._historyIgnoreKeyCode.test(t)||m.history.push(!0)},onScroll_wysiwyg:function(e){m.controllersOff(),m._isBalloon&&p._hideToolbar(),"function"===typeof y.onScroll&&y.onScroll(e,m)},onFocus_wysiwyg:function(e){m._antiBlur||(m.hasFocus=!0,p._applyTagEffects(),m._isInline&&p._showToolbarInline(),"function"===typeof y.onFocus&&y.onFocus(e,m))},onBlur_wysiwyg:function(t){m._antiBlur||m._variable.isCodeView||(m.hasFocus=!1,m.controllersOff(),(m._isInline||m._isBalloon)&&p._hideToolbar(),m._setKeyEffect([]),m._variable.currentNodes=[],m._variable.currentNodesMap=[],d.showPathLabel&&(e.element.navigation.textContent=""),"function"===typeof y.onBlur&&y.onBlur(t,m))},onMouseDown_resizingBar:function(t){t.stopPropagation(),m.submenuOff(),m.controllersOff();const n=u.getNumber(e.element.wysiwygFrame.style.height,0);m._variable.resizeClientY=t.clientY,e.element.resizeBackground.style.display="block",f.addEventListener("mousemove",p._resize_editor),f.addEventListener("mouseup",(function t(){e.element.resizeBackground.style.display="none",f.removeEventListener("mousemove",p._resize_editor),f.removeEventListener("mouseup",t),"function"===typeof y.onResizeEditor&&y.onResizeEditor(u.getNumber(e.element.wysiwygFrame.style.height,0),n,m)}))},_resize_editor:function(t){const n=e.element.editorArea.offsetHeight+(t.clientY-m._variable.resizeClientY);e.element.wysiwygFrame.style.height=e.element.code.style.height=(n<m._variable.minResizingSize?m._variable.minResizingSize:n)+"px",m._variable.resizeClientY=t.clientY},onResize_window:function(){m.controllersOff();const t=p._responsiveButtonSize;if(t){let n=0;n=(m._isBalloon||m._isInline)&&"auto"===d.toolbarWidth?e.element.topArea.offsetWidth:e.element.toolbar.offsetWidth;let i="default";for(let e=1,o=t.length;e<o;e++)if(n<t[e]){i=t[e]+"";break}p._responsiveCurrentSize!==i&&(p._responsiveCurrentSize=i,y.setToolbarButtons(p._responsiveButtons[i]))}if(0!==e.element.toolbar.offsetWidth){if(e.fileBrowser&&"block"===e.fileBrowser.area.style.display&&(e.fileBrowser.body.style.maxHeight=h.innerHeight-e.fileBrowser.header.offsetHeight-50+"px"),m.submenuActiveButton&&m.submenu&&m._setMenuPosition(m.submenuActiveButton,m.submenu),m._variable.isFullScreen)return m._variable.innerHeight_fullScreen+=h.innerHeight-e.element.toolbar.offsetHeight-m._variable.innerHeight_fullScreen,void(e.element.editorArea.style.height=m._variable.innerHeight_fullScreen+"px");m._variable.isCodeView&&m._isInline?p._showToolbarInline():(m._iframeAutoHeight(),m._sticky&&(e.element.toolbar.style.width=e.element.topArea.offsetWidth-2+"px",p.onScroll_window()))}},onScroll_window:function(){if(m._variable.isFullScreen||0===e.element.toolbar.offsetWidth||d.stickyToolbar<0)return;const t=e.element,n=t.editorArea.offsetHeight,i=(this.scrollY||f.documentElement.scrollTop)+d.stickyToolbar,o=p._getEditorOffsets(d.toolbarContainer).top-(m._isInline?t.toolbar.offsetHeight:0),s=m._isInline&&i-o>0?i-o-e.element.toolbar.offsetHeight:0;i<o?p._offStickyToolbar():i+m._variable.minResizingSize>=n+o?(m._sticky||p._onStickyToolbar(s),t.toolbar.style.top=s+n+o+d.stickyToolbar-i-m._variable.minResizingSize+"px"):i>=o&&p._onStickyToolbar(s)},_getEditorOffsets:function(t){let n=t||e.element.topArea,i=0,o=0,s=0;for(;n;)i+=n.offsetTop,o+=n.offsetLeft,s+=n.scrollTop,n=n.offsetParent;return{top:i,left:o,scroll:s}},_getPageBottomSpace:function(){return f.documentElement.scrollHeight-(p._getEditorOffsets(null).top+e.element.topArea.offsetHeight)},_onStickyToolbar:function(t){const n=e.element;m._isInline||d.toolbarContainer||(n._stickyDummy.style.height=n.toolbar.offsetHeight+"px",n._stickyDummy.style.display="block"),n.toolbar.style.top=d.stickyToolbar+t+"px",n.toolbar.style.width=m._isInline?m._inlineToolbarAttr.width:n.toolbar.offsetWidth+"px",u.addClass(n.toolbar,"se-toolbar-sticky"),m._sticky=!0},_offStickyToolbar:function(){const t=e.element;t._stickyDummy.style.display="none",t.toolbar.style.top=m._isInline?m._inlineToolbarAttr.top:"",t.toolbar.style.width=m._isInline?m._inlineToolbarAttr.width:"",t.editorArea.style.marginTop="",u.removeClass(t.toolbar,"se-toolbar-sticky"),m._sticky=!1},_codeViewAutoHeight:function(){m._variable.isFullScreen||(e.element.code.style.height=e.element.code.scrollHeight+"px")},_hardDelete:function(){const e=m.getRange(),t=e.startContainer,n=e.endContainer,i=u.getRangeFormatElement(t),o=u.getRangeFormatElement(n),s=u.isCell(i),l=u.isCell(o),r=e.commonAncestorContainer;if((s&&!i.previousElementSibling&&!i.parentElement.previousElementSibling||l&&!o.nextElementSibling&&!o.parentElement.nextElementSibling)&&i!==o)if(s){if(l)return u.removeItem(u.getParentElement(i,(function(e){return r===e.parentNode}))),m.nativeFocus(),!0;u.removeItem(u.getParentElement(i,(function(e){return r===e.parentNode})))}else u.removeItem(u.getParentElement(o,(function(e){return r===e.parentNode})));const a=1===t.nodeType?u.getParentElement(t,".se-component"):null,d=1===n.nodeType?u.getParentElement(n,".se-component"):null;return a&&u.removeItem(a),d&&u.removeItem(d),!1},onPaste_wysiwyg:function(e){const t=u.isIE?h.clipboardData:e.clipboardData;return!t||p._dataTransferAction("paste",e,t)},_setClipboardComponent:function(e,t,n){e.preventDefault(),e.stopPropagation(),n.setData("text/html",t.component.outerHTML)},onCopy_wysiwyg:function(e){const t=u.isIE?h.clipboardData:e.clipboardData;if("function"===typeof y.onCopy&&!y.onCopy(e,t,m))return e.preventDefault(),e.stopPropagation(),!1;const n=m.currentFileComponentInfo;n&&!u.isIE&&(p._setClipboardComponent(e,n,t),u.addClass(n.component,"se-component-copy"),h.setTimeout((function(){u.removeClass(n.component,"se-component-copy")}),150))},onSave_wysiwyg:function(e){"function"!==typeof y.onSave||y.onSave(e,m)},onCut_wysiwyg:function(e){const t=u.isIE?h.clipboardData:e.clipboardData;if("function"===typeof y.onCut&&!y.onCut(e,t,m))return e.preventDefault(),e.stopPropagation(),!1;const n=m.currentFileComponentInfo;n&&!u.isIE&&(p._setClipboardComponent(e,n,t),u.removeItem(n.component),m.controllersOff()),h.setTimeout((function(){m.history.push(!1)}))},onDrop_wysiwyg:function(e){if(m.isReadOnly||u.isIE)return e.preventDefault(),e.stopPropagation(),!1;const t=e.dataTransfer;return!t||(m.removeNode(),p._setDropLocationSelection(e),p._dataTransferAction("drop",e,t))},_setDropLocationSelection:function(e){if(e.rangeParent)m.setRange(e.rangeParent,e.rangeOffset,e.rangeParent,e.rangeOffset);else if(m._wd.caretRangeFromPoint){const t=m._wd.caretRangeFromPoint(e.clientX,e.clientY);m.setRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}else{const e=m.getRange();m.setRange(e.startContainer,e.startOffset,e.endContainer,e.endOffset)}},_dataTransferAction:function(t,n,i){let o,s;if(u.isIE){o=i.getData("Text");const l=m.getRange(),r=u.createElement("DIV"),a={sc:l.startContainer,so:l.startOffset,ec:l.endContainer,eo:l.endOffset};return r.setAttribute("contenteditable",!0),r.style.cssText="position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;",e.element.relative.appendChild(r),r.focus(),h.setTimeout((function(){s=r.innerHTML,u.removeItem(r),m.setRange(a.sc,a.so,a.ec,a.eo),p._setClipboardData(t,n,o,s,i)})),!0}if(o=i.getData("text/plain"),s=i.getData("text/html"),!1===p._setClipboardData(t,n,o,s,i))return n.preventDefault(),n.stopPropagation(),!1},_setClipboardData:function(e,t,n,i,o){const s=/class=["']*Mso(Normal|List)/i.test(i)||/content=["']*Word.Document/i.test(i)||/content=["']*OneNote.File/i.test(i)||/content=["']*Excel.Sheet/i.test(i);!i?i=u._HTMLConvertor(n).replace(/\n/g,"<br>"):(s?(i=i.replace(/\n/g," "),n=n.replace(/\n/g," ")):i=(n===i?n:i).replace(/\n/g,"<br>"),i=m.cleanHTML(i,m.pasteTagsWhitelistRegExp,m.pasteTagsBlacklistRegExp));const l=m._charCount(m._charTypeHTML?i:n);if("paste"===e&&"function"===typeof y.onPaste){const e=y.onPaste(t,i,l,m);if(!e)return!1;"string"===typeof e&&(i=e)}if("drop"===e&&"function"===typeof y.onDrop){const e=y.onDrop(t,i,l,m);if(!e)return!1;"string"===typeof e&&(i=e)}const r=o.files;return r.length>0&&!s?(/^image/.test(r[0].type)&&m.plugins.image&&y.insertImage(r),!1):!!l&&(i?(y.insertHTML(i,!0,!1),!1):void 0)},onMouseMove_wysiwyg:function(t){if(m.isDisabled||m.isReadOnly)return!1;const n=u.getParentElement(t.target,u.isComponent),i=m._lineBreaker.style;if(n&&!m.currentControllerName){const o=e.element;let s=0,l=o.wysiwyg;do{s+=l.scrollTop,l=l.parentElement}while(l&&!/^(BODY|HTML)$/i.test(l.nodeName));const r=o.wysiwyg.scrollTop,a=p._getEditorOffsets(null),c=u.getOffset(n,o.wysiwygFrame).top+r,f=t.pageY+s+(d.iframe&&!d.toolbarContainer?o.toolbar.offsetHeight:0),h=c+(d.iframe?s:a.top),g=u.isListCell(n.parentNode);let y="",C="";if((g?!n.previousSibling:!u.isFormatElement(n.previousElementSibling))&&f<h+20)C=c,y="t";else{if((g?n.nextSibling:u.isFormatElement(n.nextElementSibling))||!(f>h+n.offsetHeight-20))return void(i.display="none");C=c+n.offsetHeight,y="b"}m._variable._lineBreakComp=n,m._variable._lineBreakDir=y,i.top=C-r+"px",m._lineBreakerButton.style.left=u.getOffset(n).left+n.offsetWidth/2-15+"px",i.display="block"}else"none"!==i.display&&(i.display="none")},_onMouseDown_lineBreak:function(e){e.preventDefault()},_onLineBreak:function(e){e.preventDefault();const t=m._variable._lineBreakComp,n=this?this:m._variable._lineBreakDir,i=u.isListCell(t.parentNode),o=u.createElement(i?"BR":u.isCell(t.parentNode)?"DIV":d.defaultTag);if(i||(o.innerHTML="<br>"),m._charTypeHTML&&!m.checkCharCount(o.outerHTML,"byte-html"))return;t.parentNode.insertBefore(o,"t"===n?t:t.nextSibling),m._lineBreaker.style.display="none",m._variable._lineBreakComp=null;const s=i?o:o.firstChild;m.setRange(s,1,s,1),m.history.push(!1)},_addEvent:function(){const t=d.iframe?m._ww:e.element.wysiwyg;e.element.toolbar.addEventListener("mousedown",p._buttonsEventHandler,!1),e.element._menuTray.addEventListener("mousedown",p._buttonsEventHandler,!1),e.element.toolbar.addEventListener("click",p.onClick_toolbar,!1),t.addEventListener("mousedown",p.onMouseDown_wysiwyg,!1),t.addEventListener("click",p.onClick_wysiwyg,!1),t.addEventListener(u.isIE?"textinput":"input",p.onInput_wysiwyg,!1),t.addEventListener("keydown",p.onKeyDown_wysiwyg,!1),t.addEventListener("keyup",p.onKeyUp_wysiwyg,!1),t.addEventListener("paste",p.onPaste_wysiwyg,!1),t.addEventListener("copy",p.onCopy_wysiwyg,!1),t.addEventListener("cut",p.onCut_wysiwyg,!1),t.addEventListener("drop",p.onDrop_wysiwyg,!1),t.addEventListener("scroll",p.onScroll_wysiwyg,!1),t.addEventListener("focus",p.onFocus_wysiwyg,!1),t.addEventListener("blur",p.onBlur_wysiwyg,!1),p._lineBreakerBind={a:p._onLineBreak.bind(""),t:p._onLineBreak.bind("t"),b:p._onLineBreak.bind("b")},t.addEventListener("mousemove",p.onMouseMove_wysiwyg,!1),m._lineBreakerButton.addEventListener("mousedown",p._onMouseDown_lineBreak,!1),m._lineBreakerButton.addEventListener("click",p._lineBreakerBind.a,!1),e.element.lineBreaker_t.addEventListener("mousedown",p._lineBreakerBind.t,!1),e.element.lineBreaker_b.addEventListener("mousedown",p._lineBreakerBind.b,!1),m.plugins.table&&t.addEventListener("touchstart",p.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),"auto"!==d.height||d.codeMirrorEditor||(e.element.code.addEventListener("keydown",p._codeViewAutoHeight,!1),e.element.code.addEventListener("keyup",p._codeViewAutoHeight,!1),e.element.code.addEventListener("paste",p._codeViewAutoHeight,!1)),e.element.resizingBar&&(/\d+/.test(d.height)&&d.resizeEnable?e.element.resizingBar.addEventListener("mousedown",p.onMouseDown_resizingBar,!1):u.addClass(e.element.resizingBar,"se-resizing-none")),p._setResponsiveToolbar(),h.removeEventListener("resize",p.onResize_window),h.removeEventListener("scroll",p.onScroll_window),h.addEventListener("resize",p.onResize_window,!1),d.stickyToolbar>-1&&h.addEventListener("scroll",p.onScroll_window,!1)},_removeEvent:function(){const t=d.iframe?m._ww:e.element.wysiwyg;e.element.toolbar.removeEventListener("mousedown",p._buttonsEventHandler),e.element._menuTray.removeEventListener("mousedown",p._buttonsEventHandler),e.element.toolbar.removeEventListener("click",p.onClick_toolbar),t.removeEventListener("mousedown",p.onMouseDown_wysiwyg),t.removeEventListener("click",p.onClick_wysiwyg),t.removeEventListener(u.isIE?"textinput":"input",p.onInput_wysiwyg),t.removeEventListener("keydown",p.onKeyDown_wysiwyg),t.removeEventListener("keyup",p.onKeyUp_wysiwyg),t.removeEventListener("paste",p.onPaste_wysiwyg),t.removeEventListener("copy",p.onCopy_wysiwyg),t.removeEventListener("cut",p.onCut_wysiwyg),t.removeEventListener("drop",p.onDrop_wysiwyg),t.removeEventListener("scroll",p.onScroll_wysiwyg),t.removeEventListener("mousemove",p.onMouseMove_wysiwyg),m._lineBreakerButton.removeEventListener("mousedown",p._onMouseDown_lineBreak),m._lineBreakerButton.removeEventListener("click",p._lineBreakerBind.a),e.element.lineBreaker_t.removeEventListener("mousedown",p._lineBreakerBind.t),e.element.lineBreaker_b.removeEventListener("mousedown",p._lineBreakerBind.b),p._lineBreakerBind=null,t.removeEventListener("touchstart",p.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),t.removeEventListener("focus",p.onFocus_wysiwyg),t.removeEventListener("blur",p.onBlur_wysiwyg),e.element.code.removeEventListener("keydown",p._codeViewAutoHeight),e.element.code.removeEventListener("keyup",p._codeViewAutoHeight),e.element.code.removeEventListener("paste",p._codeViewAutoHeight),e.element.resizingBar&&e.element.resizingBar.removeEventListener("mousedown",p.onMouseDown_resizingBar),h.removeEventListener("resize",p.onResize_window),h.removeEventListener("scroll",p.onScroll_window)},_setResponsiveToolbar:function(){if(0===c.length)return void(c=null);p._responsiveCurrentSize="default";const e=p._responsiveButtonSize=[],t=p._responsiveButtons={default:c[0]};for(let n,i,o=1,s=c.length;o<s;o++)i=c[o],n=1*i[0],e.push(n),t[n]=i[1];e.sort((function(e,t){return e-t})).unshift("default")}},y={core:m,util:u,onload:null,onScroll:null,onMouseDown:null,onClick:null,onInput:null,onKeyDown:null,onKeyUp:null,onCopy:null,onCut:null,onFocus:null,onBlur:null,onChange:null,onSave:null,onDrop:null,onPaste:null,showInline:null,showController:null,toggleCodeView:null,toggleFullScreen:null,imageUploadHandler:null,videoUploadHandler:null,audioUploadHandler:null,onImageUploadBefore:null,onVideoUploadBefore:null,onAudioUploadBefore:null,onImageUpload:null,onVideoUpload:null,onAudioUpload:null,onImageUploadError:null,onVideoUploadError:null,onAudioUploadError:null,onResizeEditor:null,onSetToolbarButtons:null,setToolbarButtons:function(t){m.submenuOff(),m.containerOff(),m.moreLayerOff();const n=i.Z._createToolBar(f,t,m.plugins,d);c=n.responsiveButtons,p._setResponsiveToolbar(),e.element.toolbar.replaceChild(n._buttonTray,e.element._buttonTray);const s=(0,o.Z)(e.element.originElement,m._getConstructed(e.element),d);e.element=s.element,e.tool=s.tool,d.iframe&&(e.element.wysiwyg=m._wd.body),m.recoverButtonStates(),m._cachingButtons(),m.history._resetCachingButton(),m.hasFocus&&p._applyTagEffects(),m.isReadOnly&&u.setDisabledButtons(!0,m.resizingDisabledButtons),"function"===typeof y.onSetToolbarButtons&&y.onSetToolbarButtons(n._buttonTray.querySelectorAll("button"),m)},setOptions:function(o){p._removeEvent(),m._resetComponents(),u.removeClass(m._styleCommandMap.showBlocks,"active"),u.removeClass(m._styleCommandMap.codeView,"active"),m._variable.isCodeView=!1,m._iframeAuto=null,m.plugins=o.plugins||m.plugins;const s=[d,o].reduce((function(e,t){for(let n in t)if(u.hasOwn(t,n))if("plugins"===n&&t[n]&&e[n]){let i=e[n],o=t[n];i=i.length?i:h.Object.keys(i).map((function(e){return i[e]})),o=o.length?o:h.Object.keys(o).map((function(e){return o[e]})),e[n]=o.filter((function(e){return-1===i.indexOf(e)})).concat(i)}else e[n]=t[n];return e}),{}),l=e.element,r=l.wysiwyg.innerHTML,f=i.Z._setOptions(s,e,d);f.callButtons&&(t=f.callButtons,m.initPlugins={}),f.plugins&&(m.plugins=n=f.plugins),0===l._menuTray.children.length&&(this._menuTray={}),c=f.toolbar.responsiveButtons,m.options=d=s,m.lang=a=d.lang,d.iframe&&l.wysiwygFrame.addEventListener("load",(function(){u._setIframeDocument(this,d),m._setOptionsInit(l,r)})),l.editorArea.appendChild(l.wysiwygFrame),d.iframe||m._setOptionsInit(l,r)},setDefaultStyle:function(t){const n=d._editorStyles=u._setDefaultOptionStyle(d,t),i=e.element;i.topArea.style.cssText=n.top,i.code.style.cssText=d._editorStyles.frame,i.code.style.display="none","auto"===d.height?i.code.style.overflow="hidden":i.code.style.overflow="",d.iframe?(i.wysiwygFrame.style.cssText=n.frame,i.wysiwyg.style.cssText=n.editor):i.wysiwygFrame.style.cssText=n.frame+n.editor},noticeOpen:function(e){m.notice.open.call(m,e)},noticeClose:function(){m.notice.close.call(m)},save:function(){const t=m.getContents(!1);e.element.originElement.value=t,p.onSave_wysiwyg(t,m)},getContext:function(){return e},getContents:function(e){return m.getContents(e)},getText:function(){return e.element.wysiwyg.textContent},getCharCount:function(t){return t="string"===typeof t?t:d.charCounterType,m.getCharLength(m._charTypeHTML?e.element.wysiwyg.innerHTML:e.element.wysiwyg.textContent,t)},getImagesInfo:function(){return e.image?e.image._infoList:[]},getFilesInfo:function(t){return e[t]?e[t]._infoList:[]},insertImage:function(e){m.plugins.image&&e&&(m.initPlugins.image?m.plugins.image.submitAction.call(m,e):m.callPlugin("image",m.plugins.image.submitAction.bind(m,e),null),m.focus())},insertHTML:function(e,t,n,i){if("string"===typeof e){t||(e=m.cleanHTML(e,null,null));try{const t=f.createRange().createContextualFragment(e).childNodes;if(n){const e=m._charTypeHTML?"outerHTML":"textContent";let n="";for(let i=0,o=t.length;i<o;i++)n+=t[i][e];if(!m.checkCharCount(n,null))return}let o,s,l,r,a;for(;o=t[0];)r&&3===r.nodeType&&s&&1===s.nodeType&&u.isBreak(o)?(r=o,u.removeItem(o)):(l=m.insertNode(o,s,!1),s=l.container||l,a||(a=l),r=o);3===r.nodeType&&1===s.nodeType&&(s=r);const d=3===s.nodeType?l.endOffset||s.textContent.length:s.childNodes.length;i?m.setRange(a.container||a,a.startOffset||0,s,d):m.setRange(s,d,s,d)}catch(o){if(m.isDisabled||m.isReadOnly)return;console.warn("[SUNEDITOR.insertHTML.fail] "+o),m.execCommand("insertHTML",!1,e)}}else if(u.isComponent(e))m.insertComponent(e,!1,n,!1);else{let t=null;(u.isFormatElement(e)||u.isMedia(e))&&(t=u.getFormatElement(m.getSelectionNode(),null)),m.insertNode(e,t,n)}m.effectNode=null,m.focus(),m.history.push(!1)},setContents:function(e){m.setContents(e)},appendContents:function(t){const n=m.convertContentsForEditor(t);if(m._variable.isCodeView)m._setCodeView(m._getCodeView()+"\n"+m.convertHTMLForCodeView(n,!1));else{const t=u.createElement("DIV");t.innerHTML=n;const i=e.element.wysiwyg,o=t.children;for(let e=0,n=o.length;e<n;e++)i.appendChild(o[e])}m.history.push(!1)},readOnly:function(t){m.isReadOnly=t,u.setDisabledButtons(!!t,m.resizingDisabledButtons),t?(m.controllersOff(),m.submenuActiveButton&&m.submenuActiveButton.disabled&&m.submenuOff(),m._moreLayerActiveButton&&m._moreLayerActiveButton.disabled&&m.moreLayerOff(),m.containerActiveButton&&m.containerActiveButton.disabled&&m.containerOff(),m.modalForm&&m.plugins.dialog.close.call(m),e.element.code.setAttribute("readOnly","true")):e.element.code.removeAttribute("readOnly"),d.codeMirrorEditor&&d.codeMirrorEditor.setOption("readOnly",!!t)},disable:function(){this.toolbar.disable(),this.wysiwyg.disable()},disabled:function(){this.disable()},enable:function(){this.toolbar.enable(),this.wysiwyg.enable()},enabled:function(){this.enable()},show:function(){const t=e.element.topArea.style;"none"===t.display&&(t.display=d.display)},hide:function(){e.element.topArea.style.display="none"},destroy:function(){m.submenuOff(),m.containerOff(),m.controllersOff(),m.notice&&m.notice.close.call(m),m.modalForm&&m.plugins.dialog.close.call(m),m.history._destroy(),p._removeEvent(),u.removeItem(e.element.toolbar),u.removeItem(e.element.topArea);for(let e in m.functions)u.hasOwn(m,e)&&delete m.functions[e];for(let e in m)u.hasOwn(m,e)&&delete m[e];for(let e in p)u.hasOwn(p,e)&&delete p[e];for(let t in e)u.hasOwn(e,t)&&delete e[t];for(let e in t)u.hasOwn(t,e)&&delete t[e];for(let e in this)u.hasOwn(this,e)&&delete this[e]},toolbar:{disable:function(){m.submenuOff(),m.moreLayerOff(),m.containerOff(),e.tool.cover.style.display="block"},disabled:function(){this.disable()},enable:function(){e.tool.cover.style.display="none"},enabled:function(){this.enable()},show:function(){m._isInline?p._showToolbarInline():(e.element.toolbar.style.display="",e.element._stickyDummy.style.display="")},hide:function(){m._isInline?p._hideToolbar():(e.element.toolbar.style.display="none",e.element._stickyDummy.style.display="none")}},wysiwyg:{disable:function(){m.controllersOff(),m.modalForm&&m.plugins.dialog.close.call(m),e.element.wysiwyg.setAttribute("contenteditable",!1),m.isDisabled=!0,d.codeMirrorEditor?d.codeMirrorEditor.setOption("readOnly",!0):e.element.code.setAttribute("disabled","disabled")},enable:function(){e.element.wysiwyg.setAttribute("contenteditable",!0),m.isDisabled=!1,d.codeMirrorEditor?d.codeMirrorEditor.setOption("readOnly",!1):e.element.code.removeAttribute("disabled")}}};m.functions=y,m.options=d;let C=e.element,_=C.originElement,b=C.topArea;return _.style.display="none",b.style.display="block",d.iframe&&C.wysiwygFrame.addEventListener("load",(function(){u._setIframeDocument(this,d),m._editorInit(!1,d.value),d.value=null})),"object"===typeof _.nextElementSibling?_.parentNode.insertBefore(b,_.nextElementSibling):_.parentNode.appendChild(b),C.editorArea.appendChild(C.wysiwygFrame),C=_=b=null,d.iframe||(m._editorInit(!1,d.value),d.value=null),y}}}]);